<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="../../images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="../../images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../../images/favicon-16x16-next.png">
  <link rel="mask-icon" href="../../images/logo.svg" color="#222">
  <link rel="manifest" href="../../images/manifest.json">
  <meta name="msapplication-config" content="../../images/browserconfig.xml">

<link rel="stylesheet" href="../../css/main.css">


<link rel="stylesheet" href="../../lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"myblog.cuimouren.cn","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":true},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Hello, here is wenyao&#39;s space, how do you come in???">
<meta property="og:type" content="website">
<meta property="og:title" content="这里是文耀的space">
<meta property="og:url" content="http://myblog.cuimouren.cn/page/5/index.html">
<meta property="og:site_name" content="这里是文耀的space">
<meta property="og:description" content="Hello, here is wenyao&#39;s space, how do you come in???">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="崔文耀">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://myblog.cuimouren.cn/page/5/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>这里是文耀的space</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="atom.xml" title="这里是文耀的space" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">这里是文耀的space</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">wenyao'space</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="../../index.html" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="../../about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="../../tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="../../categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="../../archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://myblog.cuimouren.cn/2021/05/20/nasm-%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="崔文耀">
      <meta itemprop="description" content="Hello, here is wenyao's space, how do you come in???">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="这里是文耀的space">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="../../2021/05/20/nasm-%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">nasm 使用</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-20 16:08:33" itemprop="dateCreated datePublished" datetime="2021-05-20T16:08:33+08:00">2021-05-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-21 00:27:56" itemprop="dateModified" datetime="2021-05-21T00:27:56+08:00">2021-05-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="../../categories/uncategorized/" itemprop="url" rel="index"><span itemprop="name">uncategorized</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="nasm-使用"><a href="#nasm-使用" class="headerlink" title="nasm 使用"></a>nasm 使用</h1><h4 id="基本命令"><a href="#基本命令" class="headerlink" title="基本命令"></a>基本命令</h4><ol>
<li>汇编一个文件<blockquote>
<p>nasm -f <format> <filename> [-o <output>]<br>nasm -f elf my.asm # 把文件’my.asm’汇编成’ELF’格式 的文件’my.o’.<br>nasm -f bin my.asm -o my.bin # 把文件’my.asm’汇编成纯二进制格式的文件’my.bin’。<br>nasm -I include/ my.asm -o my.bin #添加库目录</p>
</blockquote>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://myblog.cuimouren.cn/2021/05/14/os-003-protected-mode/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="崔文耀">
      <meta itemprop="description" content="Hello, here is wenyao's space, how do you come in???">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="这里是文耀的space">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="../../2021/05/14/os-003-protected-mode/" class="post-title-link" itemprop="url">os 003 protected mode</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-14 10:45:15" itemprop="dateCreated datePublished" datetime="2021-05-14T10:45:15+08:00">2021-05-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-25 16:39:34" itemprop="dateModified" datetime="2021-05-25T16:39:34+08:00">2021-05-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="../../categories/os/" itemprop="url" rel="index"><span itemprop="name">os</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="protected-mode"><a href="#protected-mode" class="headerlink" title="protected mode"></a>protected mode</h1><h4 id="保护模式简介"><a href="#保护模式简介" class="headerlink" title="保护模式简介"></a>保护模式简介</h4><h6 id="实模式的缺陷"><a href="#实模式的缺陷" class="headerlink" title="实模式的缺陷"></a>实模式的缺陷</h6><ol>
<li><p>实模式下操作系统与用户程序属于听一个特权级，容易引起系统崩溃。</p>
</li>
<li><p>程序引用的地址指向真实的物理地址，即逻辑地址等于物理地址，不利于内存分片管理，容易造成内存碎片化。</p>
</li>
<li><p>用户程序可以随意访问任意内存。</p>
</li>
<li><p>一个短只能访问64KB地址，太小了，操作不方便。</p>
</li>
<li><p>一次只能运行一个程序。</p>
</li>
<li><p>只有20根地址线，只能寻址1M的空间，太小啦。   </p>
</li>
</ol>
<blockquote>
<p>为了克服实模式低劣的内存管理方式，开发出了保护模式。  </p>
</blockquote>
<h6 id="保护模式的特点"><a href="#保护模式的特点" class="headerlink" title="保护模式的特点"></a>保护模式的特点</h6><ol>
<li>寄存器扩展。</li>
<li>寻址空间扩展为4GB。</li>
<li>对内存分段并进行描述。全局描述符表，全局描述符表寄存器，段描述符缓冲寄存器。</li>
<li></li>
</ol>
<h6 id="进入保护模式"><a href="#进入保护模式" class="headerlink" title="进入保护模式"></a>进入保护模式</h6><p>进入保护模式的步骤为：</p>
<ol>
<li>打开A20</li>
<li>加载gdt</li>
<li>将cr0的pe位置1</li>
<li>jmp 刷新流水线</li>
</ol>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">;-----------------  打开A20  ----------------</span></span><br><span class="line"><span class="keyword">in</span> <span class="built_in">al</span>,<span class="number">0x92</span></span><br><span class="line"><span class="keyword">or</span> <span class="built_in">al</span>,<span class="number">0000_0010B</span></span><br><span class="line"><span class="keyword">out</span> <span class="number">0x92</span>,<span class="built_in">al</span></span><br><span class="line"></span><br><span class="line"><span class="comment">;-----------------  加载GDT  ----------------</span></span><br><span class="line"><span class="keyword">lgdt</span> [gdt_ptr]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">;-----------------  cr0第0位置1  ----------------</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">eax</span>, <span class="built_in">cr0</span></span><br><span class="line"><span class="keyword">or</span> <span class="built_in">eax</span>, <span class="number">0x00000001</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">cr0</span>, <span class="built_in">eax</span></span><br></pre></td></tr></table></figure>

<h4 id="内存分段"><a href="#内存分段" class="headerlink" title="内存分段"></a>内存分段</h4><h6 id="段描述符的结构"><a href="#段描述符的结构" class="headerlink" title="段描述符的结构"></a>段描述符的结构</h6><table>
<thead>
<tr>
<th>位</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>高32位</td>
<td></td>
</tr>
<tr>
<td>31-24</td>
<td>段基址31-24</td>
</tr>
<tr>
<td>23</td>
<td>G</td>
</tr>
<tr>
<td>22</td>
<td>D/B</td>
</tr>
<tr>
<td>21</td>
<td>L</td>
</tr>
<tr>
<td>20</td>
<td>AVL</td>
</tr>
<tr>
<td>19-16</td>
<td>段界限19-16</td>
</tr>
<tr>
<td>15</td>
<td>P</td>
</tr>
<tr>
<td>14-13</td>
<td>DPL</td>
</tr>
<tr>
<td>12</td>
<td>S</td>
</tr>
<tr>
<td>11-8</td>
<td>TYPE</td>
</tr>
<tr>
<td>7-0</td>
<td>段基址23-16</td>
</tr>
<tr>
<td>低32位</td>
<td></td>
</tr>
<tr>
<td>31-16</td>
<td>段基址15-0</td>
</tr>
<tr>
<td>15-0</td>
<td>段界限15-0</td>
</tr>
</tbody></table>
<ol>
<li>实际的段界限值=（描述符中的段界限值+1）*（段界限的粒度，1B 或者 4KB) - 1</li>
<li>G=0，粒度为1B，G=1，粒度为4KB.<br>3、E=0，向上扩展，常用于代码段与数据段。E=1，向下扩展，常用于栈段。</li>
</ol>
<h6 id="全局描述符表-GDT"><a href="#全局描述符表-GDT" class="headerlink" title="全局描述符表 GDT"></a>全局描述符表 GDT</h6><p>全局描述符表相当于描述符的数组，每一个元素是8字节的描述符，使用选择子进行索引。GDT中的第0个描述符是不可用的。</p>
<h6 id="全局描述符表寄存器-GDTR"><a href="#全局描述符表寄存器-GDTR" class="headerlink" title="全局描述符表寄存器 GDTR"></a>全局描述符表寄存器 GDTR</h6><p>GDT存在于内存中，GDTR是一个专门指向全局描述符表的寄存器。结构如下：</p>
<table>
<thead>
<tr>
<th>47-15</th>
<th>15-0</th>
</tr>
</thead>
<tbody><tr>
<td>GDT初始地址</td>
<td>GDT界限</td>
</tr>
</tbody></table>
<p>在实模式先使用lgdt加载描述符表，但是由于实模式的限制，此时的GTD只能处于1M地址空间以内，所以到了保护模式可以再次进行lgdt更改GDT的位置。</p>
<p>lgdt [48位内存数据]<br>按小端字节序，前16位用于舒适化GDT界限，后32位，用于指定GDT的初始地址。</p>
<h6 id="选择子"><a href="#选择子" class="headerlink" title="选择子"></a>选择子</h6><p>在实模式下，段寄存器选择的是段基址，在开启内存分段后，段寄存器存储的是对应段描述符表的索引和相关数据。选择子的结构如下：</p>
<table>
<thead>
<tr>
<th>15-4</th>
<th>3</th>
<th>2-0</th>
</tr>
</thead>
<tbody><tr>
<td>描述符索引值</td>
<td>TI</td>
<td>RPL</td>
</tr>
</tbody></table>
<p>描述符索引值正好为12位，刚好和GDTR界限所确定的最大描述符数量相匹配。</p>
<h4 id="获得内存信息"><a href="#获得内存信息" class="headerlink" title="获得内存信息"></a>获得内存信息</h4><p>eg:</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">;-------  int 15h eax = 0000E820h ,edx = 534D4150h (&#x27;SMAP&#x27;) 获取内存布局  -------</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">xor</span> <span class="built_in">ebx</span>, <span class="built_in">ebx</span>		      <span class="comment">;第一次调用时，ebx值要为0</span></span><br><span class="line">   <span class="keyword">mov</span> <span class="built_in">edx</span>, <span class="number">0x534d4150</span>	      <span class="comment">;edx只赋值一次，循环体中不会改变</span></span><br><span class="line">   <span class="keyword">mov</span> <span class="built_in">di</span>, ards_buf	      <span class="comment">;ards结构缓冲区</span></span><br><span class="line"><span class="symbol">.e820_mem_get_loop:</span>	      <span class="comment">;循环获取每个ARDS内存范围描述结构</span></span><br><span class="line">   <span class="keyword">mov</span> <span class="built_in">eax</span>, <span class="number">0x0000e820</span>	      <span class="comment">;执行int 0x15后,eax值变为0x534d4150,所以每次执行int前都要更新为子功能号。</span></span><br><span class="line">   <span class="keyword">mov</span> <span class="built_in">ecx</span>, <span class="number">20</span>		      <span class="comment">;ARDS地址范围描述符结构大小是20字节</span></span><br><span class="line">   <span class="keyword">int</span> <span class="number">0x15</span></span><br><span class="line">   <span class="keyword">jc</span> .e820_failed_so_try_e801   <span class="comment">;若cf位为1则有错误发生，尝试0xe801子功能</span></span><br><span class="line">   <span class="keyword">add</span> <span class="built_in">di</span>, <span class="built_in">cx</span>		      <span class="comment">;使di增加20字节指向缓冲区中新的ARDS结构位置</span></span><br><span class="line">   <span class="keyword">inc</span> <span class="built_in">word</span> [ards_nr]	      <span class="comment">;记录ARDS数量</span></span><br><span class="line">   <span class="keyword">cmp</span> <span class="built_in">ebx</span>, <span class="number">0</span>		      <span class="comment">;若ebx为0且cf不为1,这说明ards全部返回，当前已是最后一个</span></span><br><span class="line">   <span class="keyword">jnz</span> .e820_mem_get_loop</span><br><span class="line"></span><br><span class="line"><span class="comment">;在所有ards结构中，找出(base_add_low + length_low)的最大值，即内存的容量。</span></span><br><span class="line">   <span class="keyword">mov</span> <span class="built_in">cx</span>, [ards_nr]	      <span class="comment">;遍历每一个ARDS结构体,循环次数是ARDS的数量</span></span><br><span class="line">   <span class="keyword">mov</span> <span class="built_in">ebx</span>, ards_buf </span><br><span class="line">   <span class="keyword">xor</span> <span class="built_in">edx</span>, <span class="built_in">edx</span>		      <span class="comment">;edx为最大的内存容量,在此先清0</span></span><br><span class="line"><span class="symbol">.find_max_mem_area:</span>	      <span class="comment">;无须判断type是否为1,最大的内存块一定是可被使用</span></span><br><span class="line">   <span class="keyword">mov</span> <span class="built_in">eax</span>, [<span class="built_in">ebx</span>]	      <span class="comment">;base_add_low</span></span><br><span class="line">   <span class="keyword">add</span> <span class="built_in">eax</span>, [<span class="built_in">ebx</span>+<span class="number">8</span>]	      <span class="comment">;length_low</span></span><br><span class="line">   <span class="keyword">add</span> <span class="built_in">ebx</span>, <span class="number">20</span>		      <span class="comment">;指向缓冲区中下一个ARDS结构</span></span><br><span class="line">   <span class="keyword">cmp</span> <span class="built_in">edx</span>, <span class="built_in">eax</span>		      <span class="comment">;冒泡排序，找出最大,edx寄存器始终是最大的内存容量</span></span><br><span class="line">   <span class="keyword">jge</span> .next_ards</span><br><span class="line">   <span class="keyword">mov</span> <span class="built_in">edx</span>, <span class="built_in">eax</span>		      <span class="comment">;edx为总内存大小</span></span><br><span class="line"><span class="symbol">.next_ards:</span></span><br><span class="line">   <span class="keyword">loop</span> .find_max_mem_area</span><br><span class="line">   <span class="keyword">jmp</span> .mem_get_ok</span><br><span class="line"></span><br><span class="line"><span class="comment">;------  int 15h ax = E801h 获取内存大小,最大支持4G  ------</span></span><br><span class="line"><span class="comment">; 返回后, ax cx 值一样,以KB为单位,bx dx值一样,以64KB为单位</span></span><br><span class="line"><span class="comment">; 在ax和cx寄存器中为低16M,在bx和dx寄存器中为16MB到4G。</span></span><br><span class="line"><span class="symbol">.e820_failed_so_try_e801:</span></span><br><span class="line">   <span class="keyword">mov</span> <span class="built_in">ax</span>,<span class="number">0xe801</span></span><br><span class="line">   <span class="keyword">int</span> <span class="number">0x15</span></span><br><span class="line">   <span class="keyword">jc</span> .e801_failed_so_try88   <span class="comment">;若当前e801方法失败,就尝试0x88方法</span></span><br><span class="line"></span><br><span class="line"><span class="comment">;1 先算出低15M的内存,ax和cx中是以KB为单位的内存数量,将其转换为以byte为单位</span></span><br><span class="line">   <span class="keyword">mov</span> <span class="built_in">cx</span>,<span class="number">0x400</span>	     <span class="comment">;cx和ax值一样,cx用做乘数</span></span><br><span class="line">   <span class="keyword">mul</span> <span class="built_in">cx</span> </span><br><span class="line">   <span class="keyword">shl</span> <span class="built_in">edx</span>,<span class="number">16</span></span><br><span class="line">   <span class="keyword">and</span> <span class="built_in">eax</span>,<span class="number">0x0000FFFF</span></span><br><span class="line">   <span class="keyword">or</span> <span class="built_in">edx</span>,<span class="built_in">eax</span></span><br><span class="line">   <span class="keyword">add</span> <span class="built_in">edx</span>, <span class="number">0x100000</span> <span class="comment">;ax只是15MB,故要加1MB</span></span><br><span class="line">   <span class="keyword">mov</span> <span class="built_in">esi</span>,<span class="built_in">edx</span>	     <span class="comment">;先把低15MB的内存容量存入esi寄存器备份</span></span><br><span class="line"></span><br><span class="line"><span class="comment">;2 再将16MB以上的内存转换为byte为单位,寄存器bx和dx中是以64KB为单位的内存数量</span></span><br><span class="line">   <span class="keyword">xor</span> <span class="built_in">eax</span>,<span class="built_in">eax</span></span><br><span class="line">   <span class="keyword">mov</span> <span class="built_in">ax</span>,<span class="built_in">bx</span>		</span><br><span class="line">   <span class="keyword">mov</span> <span class="built_in">ecx</span>, <span class="number">0x10000</span>	<span class="comment">;0x10000十进制为64KB</span></span><br><span class="line">   <span class="keyword">mul</span> <span class="built_in">ecx</span>		<span class="comment">;32位乘法,默认的被乘数是eax,积为64位,高32位存入edx,低32位存入eax.</span></span><br><span class="line">   <span class="keyword">add</span> <span class="built_in">esi</span>,<span class="built_in">eax</span>		<span class="comment">;由于此方法只能测出4G以内的内存,故32位eax足够了,edx肯定为0,只加eax便可</span></span><br><span class="line">   <span class="keyword">mov</span> <span class="built_in">edx</span>,<span class="built_in">esi</span>		<span class="comment">;edx为总内存大小</span></span><br><span class="line">   <span class="keyword">jmp</span> .mem_get_ok</span><br><span class="line"></span><br><span class="line"><span class="comment">;-----------------  int 15h ah = 0x88 获取内存大小,只能获取64M之内  ----------</span></span><br><span class="line"><span class="symbol">.e801_failed_so_try88:</span> </span><br><span class="line">   <span class="comment">;int 15后，ax存入的是以kb为单位的内存容量</span></span><br><span class="line">   <span class="keyword">mov</span>  <span class="number">ah</span>, <span class="number">0x88</span></span><br><span class="line">   <span class="keyword">int</span>  <span class="number">0x15</span></span><br><span class="line">   <span class="keyword">jc</span> .error_hlt</span><br><span class="line">   <span class="keyword">and</span> <span class="built_in">eax</span>,<span class="number">0x0000FFFF</span></span><br><span class="line">      </span><br><span class="line">   <span class="comment">;16位乘法，被乘数是ax,积为32位.积的高16位在dx中，积的低16位在ax中</span></span><br><span class="line">   <span class="keyword">mov</span> <span class="built_in">cx</span>, <span class="number">0x400</span>     <span class="comment">;0x400等于1024,将ax中的内存容量换为以byte为单位</span></span><br><span class="line">   <span class="keyword">mul</span> <span class="built_in">cx</span></span><br><span class="line">   <span class="keyword">shl</span> <span class="built_in">edx</span>, <span class="number">16</span>	     <span class="comment">;把dx移到高16位</span></span><br><span class="line">   <span class="keyword">or</span> <span class="built_in">edx</span>, <span class="built_in">eax</span>	     <span class="comment">;把积的低16位组合到edx,为32位的积</span></span><br><span class="line">   <span class="keyword">add</span> <span class="built_in">edx</span>,<span class="number">0x100000</span>  <span class="comment">;0x88子功能只会返回1MB以上的内存,故实际内存大小要加上1MB</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">.mem_get_ok:</span></span><br><span class="line">   <span class="keyword">mov</span> [total_mem_bytes], <span class="built_in">edx</span>	 <span class="comment">;将内存换为byte单位后存入total_mem_bytes处。</span></span><br></pre></td></tr></table></figure>

<h4 id="内存分页"><a href="#内存分页" class="headerlink" title="内存分页"></a>内存分页</h4><p><strong>分段是分页的前提</strong></p>
<h6 id="内存分段模式下的问题"><a href="#内存分段模式下的问题" class="headerlink" title="内存分段模式下的问题"></a>内存分段模式下的问题</h6><ol>
<li>物理内存不足时怎么把？</li>
<li>内存碎片化问题怎么解决。</li>
</ol>
<blockquote>
<p>在保护模式下，段描述符是内存段的身份证，cpu根据一个段描述符来引用一个段。很多时候，段描述符对应的段并不在内存中。如果一个描述符的P位为1，则表示该段在内存中存在。访问过一个段后，cpu将该描述符中的A为置1。如果P位为0，则说明内存中不存在这个段，则cpu抛出np异常，操作系统将对应的段加载到内存中。</p>
</blockquote>
<blockquote>
<p>分页机制的思想是，通过映射，可以使连续的线性地址与任意物理内存地址相关联，逻辑上连续的额线性地址在物理上可以不连续。分页机制将大小不不等的段分解为大小相等的页，再将页映射到物理页。分页机制的作用有：将线性地址转化为物理地址，用大小相等的页代替大小不等的段。有了页表的映射关系，经过段部件的处理输出的则为虚拟地址。在分页机制下，每个进程都认为自己独享整个4GB空间。即程序以为自己身处于段式存储下并拥有4GB空间，但是他的地址经由页部件处理之后才是真正的物理地址。</p>
</blockquote>
<h6 id="一级页表"><a href="#一级页表" class="headerlink" title="一级页表"></a>一级页表</h6><blockquote>
<p>页表用于存储线性地址与物理地址之间的映射。页表中的每一项为大小为4字节的页表项，用来记录4GB空间的物理地址。当访问一个线性地址的时候，实际上就是在访问页表项中对应的物理地址。</p>
</blockquote>
<blockquote>
<p>每个页大小为4KB，一个页表可以存储1M个页表项，加起来一个页表可以表示整个4GB物理空间。</p>
</blockquote>
<blockquote>
<p>一级页表的地址转换过程为：用线性地址的高20位作为页表项的索引，每个页表项占用4字节的大小，索引值乘上4就可以得到该页表项在页表中的偏移量。用cr3寄存器中的页表物理地址加上此偏移量就可以得到该页表项的物理地址，从该页表项中得到映射的物理地址，再与低12位的线性地址相加就可以得到最终要访问的物理地址。</p>
</blockquote>
<blockquote>
<p>假设咱们是在平坦模型下工作，不管段选择子值是多少，其所指向的段基址都是 0，指令 mov ax，<br>[0x1234]中的 0x1234 称为有效地址，它作为“段基址：段内偏移地址”中的段内偏移地址。这样段基址<br>为 0，段内偏移地址为 0x1234，经过段部件处理后，输出的线性地址是 0x1234。由于咱们是演示分页机制，必须假定系统已经打开了分页机制，所以线性地址 0x1234 被送入了页部件。页部件分析 0x1234 的高20 位，用十六进制表示高 20 位是 0x00001。将此项作为页表项索引，再将该索引乘以 4 后加上 cr3 寄存器中页表的物理地址，这样便得到索引所指代的页表项的物理地址，从该物理地址处（页表项中）读取所映射的物理页地址：0x9000。线性地址的低 12 位是 0x234，它作为物理页的页内偏移地址与物理页地址0x9000 相加，和为 0x9234，这就是线性地址 0x1234 最终转换成的物理地址。     </p>
</blockquote>
<h6 id="二级页表"><a href="#二级页表" class="headerlink" title="二级页表"></a>二级页表</h6><blockquote>
<p>二级页表将4GB空间按每一个标准页大小4KB分为1M个页，将这1M个页分1K*1K个页，每1K个页表项又正好可以组成一个新的页（1K*4B=4KB），将这个新产生的页记录为一个页表项，则总共会产生1K个新的页表项，再将这1K个页表项组成一个标准页，则最后产生的这个标准页为页目录表，其中每一项为页目录项PDE。</p>
</blockquote>
<blockquote>
<p>二级页表地址转换原理是将 32 位虚拟地址拆分成高 10 位、中间 10 位、低 12 位三部分，它们<br>的作用是：高 10 位作为页表的索引，用于在页目录表中定位一个页目录项 PDE，页目录项中有页表物理地址，也就是定位到了某个页表。中间 10 位作为物理页的索引，用于在页表内定位到某个页表项 PTE，页表项中有分配的物理页地址，也就是定位到了某个物理页。低 12 位作为页内偏移量用于在已经定位到的物理页内寻址。</p>
</blockquote>
<blockquote>
<p>转换过程背后的具体步骤如下。<br>（1）用虚拟地址的高 10 位乘以 4，作为页目录表内的偏移地址，加上页目录表的物理地址，所得的<br>和，便是页目录项的物理地址。读取该页目录项，从中获取到页表的物理地址。<br>（2）用虚拟地址的中间 10 位乘以 4，作为页表内的偏移地址，加上在第 1 步中得到的页表物理地址，<br>所得的和，便是页表项的物理地址。读取该页表项，从中获取到分配的物理页地址。<br>（3）虚拟地址的高 10 位和中间 10 位分别是 PDE 和 PTE 的索引值，所以它们需要乘以 4。但低 12 位就不是索引值啦，其表示的范围是 0～0xfff，作为页内偏移最合适，所以虚拟地址的低 12 位加上第 2 步中得到的物理页地址，所得的和便是最终转换的物理地址。 </p>
</blockquote>
<h6 id="页目录项和页表项的结构"><a href="#页目录项和页表项的结构" class="headerlink" title="页目录项和页表项的结构"></a>页目录项和页表项的结构</h6><p><strong>页目录项</strong>    </p>
<table>
<thead>
<tr>
<th>31-12</th>
<th>11-9</th>
<th>8</th>
<th>7</th>
<th>6</th>
<th>5</th>
<th>4</th>
<th>3</th>
<th>2</th>
<th>1</th>
<th>0</th>
</tr>
</thead>
<tbody><tr>
<td>页表物理页地址31-12位</td>
<td>AVL</td>
<td>G</td>
<td>0</td>
<td>D</td>
<td>A</td>
<td>PCD</td>
<td>PWT</td>
<td>US</td>
<td>RW</td>
<td>P</td>
</tr>
</tbody></table>
<p><strong>页表项</strong>    </p>
<table>
<thead>
<tr>
<th>31-12</th>
<th>11-9</th>
<th>8</th>
<th>7</th>
<th>6</th>
<th>5</th>
<th>4</th>
<th>3</th>
<th>2</th>
<th>1</th>
<th>0</th>
</tr>
</thead>
<tbody><tr>
<td>物理页地址31-12位</td>
<td>AVL</td>
<td>G</td>
<td>PAT</td>
<td>D</td>
<td>A</td>
<td>PCD</td>
<td>PWT</td>
<td>US</td>
<td>RW</td>
<td>P</td>
</tr>
</tbody></table>
<blockquote>
<p>页表目录项和页表项中的都是物理页地址，标准页大小就是4KB，所以地址都是4K的倍数，即低12位全为零，所以只需要记录高20位就可以了。省下来的12位可以用于其他属性。</p>
</blockquote>
<blockquote>
<p>P，Present，意为存在位。若为 1 表示该页存在于物理内存中，若为 0 表示该表不在物理内存中。操<br>作系统的页式虚拟内存管理便是通过 P 位和相应的 pagefault 异常来实现的。</p>
</blockquote>
<blockquote>
<p>RW，Read/Write，意为读写位。若为 1 表示可读可写，若为 0 表示可读不可写。</p>
</blockquote>
<blockquote>
<p>US，User/Supervisor，意为普通用户/超级用户位。若为 1 时，表示处于 User 级，任意级别（0、1、2、 3）特权的程序都可以访问该页。若为 0，表示处于 Supervisor 级，特权级别为 3 的程序不允许访问该页，该页只允许特权级别为 0、1、2 的程序可以访问。</p>
</blockquote>
<blockquote>
<p>PWT，Page-level Write-Through，意为页级通写位，也称页级写透位。若为 1 表示此项采用通写方式，表示该页不仅是普通内存，还是高速缓存。此项和高速缓存有关，“通写”是高速缓存的一种工作方式，本位用来间接决定是否用此方式改善该页的访问效率。这里咱们直接置为 0 就可以啦。</p>
</blockquote>
<blockquote>
<p>PCD，Page-level Cache Disable，意为页级高速缓存禁止位。若为 1 表示该页启用高速缓存，为 0 表示禁止将该页缓存。这里咱们将其置为 0。 A，Accessed，意为访问位。若为 1 表示该页被 CPU 访问过啦，所以该位是由 CPU 设置的。还记得段描述符中的 A 位和 P 位吗？这两位在一起可以实现段式虚拟内存管理。和它们一样，这里页目录项和页表项中的 A 位也可以用来记录某一内存页的使用频率（操作系统定期将该位清 0，统计一段时间内变成 1 的次数），从而当内存不足时，可以将使用频率较低的页面换出到外存（如硬盘），同时将页目录项或页表项的 P位置 0，下次访问该页引起 pagefault 异常时，中断处理程序将硬盘上的页再次换入，同时将 P 位置 1。 D，Dirty，意为脏页位。当 CPU 对一个页面执行写操作时，就会设置对应页表项的 D 位为 1。此项仅针对页表项有效，并不会修改页目录项中的 D 位。</p>
</blockquote>
<blockquote>
<p>PAT，Page Attribute Table，意为页属性表位，能够在页面一级的粒度上设置内存属性。比较复杂，将此位置 0 即可。</p>
</blockquote>
<blockquote>
<p>G,Global，意为全局位。由于内存地址转换也是颇费周折，先得拆分虚拟地址，然后又要查页目录，又要查页表的，所以为了提高获取物理地址的速度，将虚拟地址与物理地址转换结果存储在 TLB（Translation Lookaside Buffer）中，TLB 以后咱们会细说。在此先知道 TLB 是用来缓存地址转换结果的高速缓存就 ok 啦。此 G 位用来指定该页是否为全局页，为 1 表示是全局页，为 0 表示不是全局页。若为全局页，该页将在高速缓存 TLB 中一直保存，给出虚拟地址直接就出物理地址啦，无需那三步骤转换。由于 TLB 容量比较小（一般速度较快的存储设备容量都比较小），所以这里面就存放使用频率较高的页面。顺便说一句，清空 TLB 有两种方式，一是用 invlpg 指令针对单独虚拟地址条目清理，或者是重新加载 cr3 寄存器，这将直接清空 TLB。</p>
</blockquote>
<blockquote>
<p>AVL，意为 Available 位，表示可用，谁可以用？当然是软件，操作系统可用该位，CPU 不理会该位<br>的值，那咱们也不理会吧。</p>
</blockquote>
<h6 id="开启分页"><a href="#开启分页" class="headerlink" title="开启分页"></a>开启分页</h6><p>开启分页需要顺序做以下三件事情。</p>
<ol>
<li>准备好页目录表和页表。</li>
<li>将页表地址写入控制寄存器cr3。</li>
<li>寄存器的PG位置1.</li>
</ol>
<h4 id="elf-executable-and-linkable-format"><a href="#elf-executable-and-linkable-format" class="headerlink" title="elf (executable and linkable format)"></a>elf (executable and linkable format)</h4><h6 id="elf中的数据类型"><a href="#elf中的数据类型" class="headerlink" title="elf中的数据类型"></a>elf中的数据类型</h6><table>
<thead>
<tr>
<th>数据类型名称</th>
<th>字节大小</th>
<th>对齐</th>
<th>意义</th>
</tr>
</thead>
<tbody><tr>
<td>Elf_Half</td>
<td>2</td>
<td>2</td>
<td>无符号中等大小的整数</td>
</tr>
<tr>
<td>Elf_Word</td>
<td>4</td>
<td>4</td>
<td>无符号大整数</td>
</tr>
<tr>
<td>Elf_Addr</td>
<td>4</td>
<td>4</td>
<td>无符号程序运行地址</td>
</tr>
<tr>
<td>Elf_Off</td>
<td>4</td>
<td>4</td>
<td>无符号文件偏移量</td>
</tr>
</tbody></table>
<h4 id="特权级"><a href="#特权级" class="headerlink" title="特权级"></a>特权级</h4><blockquote>
<p>RPL:请求特权级指令请求访问其他资源的能力成为请求特权级，指令存放在代码段中，所所以使用CS中选择子的RPL位表示代码请求别人资源的能力。    </p>
</blockquote>
<blockquote>
<p>CPL：表示处理器当亲的特权级。指令最终是由处理器执行的，执行到不同特权的代码，处理器的特权级就切换到不同的等级。代码段描述符中的DPL便是当前处理器所处的特权级。    </p>
</blockquote>
<blockquote>
<p>对于数据段来讲，只有访问者的权限大于或等于段描述符中的DPL表示的最低权限时才能够访问。</p>
</blockquote>
<blockquote>
<p>对于代码段来讲，只有访问者的权限<strong>等于</strong>段描述符中的DPL才能访问。即只能平级访问。访问一个代码段实质上就是跳转到这个段进行执行。唯一一种处理器从高特权级降到低特权级执行的情况是处理器从中断处理程序中返回到用户态。</p>
</blockquote>
<blockquote>
<p>一致性代码段：一致性代码段也成为依从代码段，用来实现从低特权级的代码向高特权级代码的转移。一致性代码段是指如果自己是转移后的目标段，则自己的特权级一定能要大于等于转移前的CPL，也就是说一致性代码段的DPL是特权的上限。处理器遇到目标端位一致性代码段的时候并不会将CPL用该段的DPL来替换。代码段可以有一致性与不一致性的段，但是数据段只能有非一致性，即数据段不允许比自己特权级低的代码段访问。</p>
</blockquote>
<h4 id="函数调约定"><a href="#函数调约定" class="headerlink" title="函数调约定"></a>函数调约定</h4><h6 id="cdecl-c-declaration-即c声明"><a href="#cdecl-c-declaration-即c声明" class="headerlink" title="cdecl (c declaration 即c声明)"></a>cdecl (c declaration 即c声明)</h6><p>函数参数从右到左顺序入栈，EAX,ECX,EDX,寄存器由<strong>调用者</strong>保存，其余的寄存器由<strong>被调用者</strong>保存。函数的返回值存储在EAX寄存器中。由<strong>调用者</strong>清理栈空间。</p>
<p>示例：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> subtract(<span class="keyword">int</span> a, <span class="keyword">int</span> b)<span class="comment">; //被调用者</span></span><br><span class="line"><span class="keyword">int</span> <span class="keyword">sub</span> = subtract (<span class="number">3</span>,<span class="number">2</span>)<span class="comment">; // 主调用者</span></span><br><span class="line">主调用者：</span><br><span class="line"><span class="comment">; 从右到左将参数入栈</span></span><br><span class="line"><span class="keyword">push</span> <span class="number">2</span> <span class="comment">;压入参数 b </span></span><br><span class="line"><span class="keyword">push</span> <span class="number">3</span> <span class="comment">;压入参数 a </span></span><br><span class="line"><span class="keyword">call</span> subtract <span class="comment">;调用函数 subtract </span></span><br><span class="line"><span class="keyword">add</span> <span class="built_in">esp</span>, <span class="number">8</span> <span class="comment">;回收（清理）栈空间</span></span><br><span class="line">被调用者：</span><br><span class="line"><span class="keyword">push</span> <span class="built_in">ebp</span> <span class="comment">;压入 ebp 备份</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">ebp</span>,<span class="built_in">esp</span> <span class="comment">;将 esp 赋值给 ebp </span></span><br><span class="line"> <span class="comment">;用 ebp 作为基址来访问栈中参数</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">eax</span>,[<span class="built_in">ebp</span>+<span class="number">0x8</span>] <span class="comment">;偏移 8 字节处为第 1 个参数 a </span></span><br><span class="line"><span class="keyword">add</span> <span class="built_in">eax</span>,[<span class="built_in">ebp</span>+<span class="number">0xc</span>] <span class="comment">;偏移 0xc 字节处是第 2 个参数 b </span></span><br><span class="line"> <span class="comment">;参数 a 和 b 相加后存入 eax </span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">esp</span>,<span class="built_in">ebp</span> <span class="comment">;为防止中间有入栈操作，用 ebp 恢复 esp </span></span><br><span class="line"> <span class="comment">;本句在此例子中可有可无,属于通用代码</span></span><br><span class="line"><span class="keyword">pop</span> <span class="built_in">ebp</span> <span class="comment">;将 ebp 恢复</span></span><br><span class="line"><span class="keyword">ret</span></span><br></pre></td></tr></table></figure>


<h4 id="C与汇编混合编程"><a href="#C与汇编混合编程" class="headerlink" title="C与汇编混合编程"></a>C与汇编混合编程</h4><p>c语言和汇编语言混合编程分为两种：</p>
<ol>
<li>单独的汇编代码文件与单独的c语言文件分别编译成目标文件后，再进行连接成可执行程序。</li>
<li>再c语言中嵌入汇编语言，直接编译成生可执行程序。这种也叫做内联汇编。</li>
</ol>
<h4 id="内联汇编"><a href="#内联汇编" class="headerlink" title="内联汇编"></a>内联汇编</h4><h6 id="基本内联汇编"><a href="#基本内联汇编" class="headerlink" title="基本内联汇编"></a>基本内联汇编</h6><p>格式：<br>asm [volatile](“asm code”)       </p>
<ol>
<li>指令必须要用双引号括起来</li>
<li>一对双引号不可以跨行，如果跨行需要在结尾使用’\‘转义。</li>
<li>指令之间使用’;’,’\n’,’\t’分隔开。</li>
<li>即使指令分隔在多个双引号中也要使用分隔符。</li>
</ol>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> char* str=<span class="string">&quot;hello,world\n&quot;</span>; </span><br><span class="line"> <span class="keyword">int</span> count = <span class="number">0</span>; </span><br><span class="line"> void main()&#123; </span><br><span class="line"> asm(<span class="string">&quot;pusha; \ </span></span><br><span class="line"><span class="string"> movl $4,%eax; \ </span></span><br><span class="line"><span class="string"> movl $1,%ebx; \ </span></span><br><span class="line"><span class="string"> movl str,%ecx; \ </span></span><br><span class="line"><span class="string"> movl $12,%edx; \ </span></span><br><span class="line"><span class="string"> int $0x80; \ </span></span><br><span class="line"><span class="string">mov %eax,count;\ </span></span><br><span class="line"><span class="string">popa \ </span></span><br><span class="line"><span class="string">&quot;</span>); </span><br><span class="line">&#125; </span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h6 id="扩展内联汇编"><a href="#扩展内联汇编" class="headerlink" title="扩展内联汇编"></a>扩展内联汇编</h6><p>格式：<br>asm [volatile] (“assembly code”:output : input : clobber/modify)</p>
<ol>
<li><p>assembly code：还是用户写入的汇编指令，和基本内联汇编一样。</p>
</li>
<li><p>output:output 用来指定汇编代码的数据如何输出给 C 代码使用。内嵌的汇编指令运行结束后，如果想将运行结果存储到 c 变量中，就用此项指定输出的位置。</p>
</li>
<li><p>input：input 用来指定 C 中数据如何输入给汇编使用。要想让汇编使用 C 中的变量作为参数，就要在此指定。</p>
</li>
<li><p>clobber/modify：汇编代码执行后会破坏一些内存或寄存器资源，通过此项通知编译器，可能造成寄<br>存器或内存数据的破坏，这样 gcc 就知道哪些寄存器或内存需要提前保护起来。</p>
</li>
</ol>
<p><strong>约束</strong></p>
<ol>
<li>寄存器约束  </li>
</ol>
<p>寄存器约束就是要求 gcc 使用哪个寄存器，将 input 或 output 中变量约束在某个寄存器中。常见的寄存器约束有：<br>a：表示寄存器 eax/ax/al<br>b：表示寄存器 ebx/bx/bl<br>c：表示寄存器 ecx/cx/cl<br>d：表示寄存器 edx/dx/dl<br>D：表示寄存器 edi/di<br>S：表示寄存器 esi/si<br>q：表示任意这 4 个通用寄存器之一：eax/ebx/ecx/edx<br>r：表示任意这 6 个通用寄存器之一：eax/ebx/ecx/edx/esi/edi<br>g：表示可以存放到任意地点（寄存器和内存）。相当于除了同 q 一样外，还可以让 gcc 安排在内存中<br>A：把 eax 和 edx 组合成 64 位整数<br>f：表示浮点寄存器<br>t：表示第 1 个浮点寄存器<br>u：表示第 2 个浮点寄存器      </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span> </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123; </span><br><span class="line"><span class="keyword">int</span> in_a = <span class="number">1</span>, in_b = <span class="number">2</span>, out_sum; </span><br><span class="line"><span class="built_in"><span class="keyword">asm</span></span>(<span class="string">&quot;addl %%ebx, %%eax&quot;</span>:<span class="string">&quot;=a&quot;</span>(out_sum):<span class="string">&quot;a&quot;</span>(in_a),<span class="string">&quot;b&quot;</span>(in_b)); </span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;sum is %d\n&quot;</span>,out_sum); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>内存约束</li>
</ol>
<p>内存约束是要求 gcc 直接将位于 input 和 output 中的 C 变量的内存地址作为内联汇编代码的操作数，不需要寄存器做中转，直接进行内存读写，也就是汇编代码的操作数是 C 变量的指针。    </p>
<p>m：表示操作数可以使用任意一种内存形式。<br>o：操作数为内存变量，但访问它是通过偏移量的形式访问，即包含 offset_address 的格式。       </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span> </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123; </span><br><span class="line"><span class="keyword">int</span> in_a = <span class="number">1</span>, in_b = <span class="number">2</span>; </span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;in_b is %d\n&quot;</span>, in_b); </span><br><span class="line"><span class="built_in"><span class="keyword">asm</span></span>(<span class="string">&quot;movb %b0, %1;&quot;</span>::<span class="string">&quot;a&quot;</span>(in_a),<span class="string">&quot;m&quot;</span>(in_b)); </span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;in_b now is %d\n&quot;</span>, in_b); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>立即数约束</li>
</ol>
<p>i：表示操作数为整数立即数<br>F：表示操作数为浮点数立即数<br>I：表示操作数为 0～31 之间的立即数<br>J：表示操作数为 0～63 之间的立即数<br>N：表示操作数为 0～255 之间的立即数<br>O：表示操作数为 0～32 之间的立即数<br>X：表示操作数为任何类型立即数    </p>
<ol start="4">
<li>通用约束</li>
</ol>
<p>0～9：此约束只用在 input 部分，但表示可与 output 和 input 中第 n 个操作数用相同的寄存器或内存。</p>
<h4 id="AT-amp-T汇编"><a href="#AT-amp-T汇编" class="headerlink" title="AT&amp;T汇编"></a>AT&amp;T汇编</h4><p>intel 与 AT&amp;T 语法风格对比</p>
<table>
<thead>
<tr>
<th>区别</th>
<th>intel</th>
<th>AT&amp;T</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>寄存器</td>
<td>寄存器没有钱追你</td>
<td>寄存器有前缀%</td>
<td></td>
</tr>
<tr>
<td>操作数顺序</td>
<td>目的操作数在左边，源操作数在右边</td>
<td>相反</td>
<td></td>
</tr>
<tr>
<td>操作数指定大小</td>
<td>有关内存的操作数要加数据类型指定大小，byte：8位，word:16位，dword:32位</td>
<td>指令的最后一个字母代表指令操作数大小，b:8位，w:16位，l:32位。</td>
<td></td>
</tr>
<tr>
<td>立即数</td>
<td>没有前缀</td>
<td>有前缀$</td>
<td></td>
</tr>
<tr>
<td>远跳转</td>
<td>jmp far segment:offset</td>
<td>ljmp $segment:$offset</td>
<td></td>
</tr>
<tr>
<td>远调用</td>
<td>call far segment:offset</td>
<td>lcall $segment:$offset</td>
<td></td>
</tr>
<tr>
<td>远返回</td>
<td>ret far n</td>
<td>lret $n</td>
<td></td>
</tr>
</tbody></table>
<p>内存寻址格式：<br>segreg(段基址):base_address(offset,index,size)        </p>
<p>segreg:base_address+offset+index*size</p>
<h4 id="打印-printf-的实现"><a href="#打印-printf-的实现" class="headerlink" title="打印 printf 的实现"></a>打印 printf 的实现</h4><h6 id="打印字符"><a href="#打印字符" class="headerlink" title="打印字符"></a>打印字符</h6><p>在printf.h中声明函数</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">void put<span class="constructor">_char(<span class="params">uint8_t</span> <span class="params">char_asci</span>)</span></span><br></pre></td></tr></table></figure>

<p>在print.s中完成函数的定义</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">global</span> put_char</span><br><span class="line"><span class="comment">;外部符号声明 </span></span><br><span class="line"><span class="keyword">pushad</span>   <span class="comment">;备份8个32位寄存器</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>,SELECTOR_VIDEO</span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">gs</span>,<span class="built_in">ax</span></span><br><span class="line"></span><br><span class="line"><span class="comment">;获取光标位置</span></span><br><span class="line"><span class="comment">;高8位</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">dx</span>,<span class="number">0x03d4</span>  <span class="comment">;索引寄存器</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">al</span>,<span class="number">0x0e</span>    <span class="comment">;光标位置高8位</span></span><br><span class="line"><span class="keyword">out</span> <span class="built_in">dx</span>,<span class="built_in">al</span>      </span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">dx</span>,<span class="number">0x03d5</span>     </span><br><span class="line"><span class="keyword">in</span> <span class="built_in">al</span>,<span class="built_in">dx</span></span><br><span class="line"><span class="keyword">mov</span> <span class="number">ah</span>,<span class="built_in">al</span></span><br><span class="line"><span class="comment">;低8位</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">dx</span>,<span class="number">0x03d4</span>  <span class="comment">;索引寄存器</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">al</span>,<span class="number">0x0f</span>   <span class="comment">;光标位置高8位</span></span><br><span class="line"><span class="keyword">out</span> <span class="built_in">dx</span>,<span class="built_in">al</span>      </span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">dx</span>,<span class="number">0x03d5</span>     </span><br><span class="line"><span class="keyword">in</span> <span class="built_in">al</span>,<span class="built_in">dx</span></span><br><span class="line"></span><br><span class="line"><span class="comment">;光标为值存放在bx中</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>,<span class="built_in">bx</span></span><br><span class="line"><span class="comment">;取得要打印的字符</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">ecx</span>,[<span class="built_in">esp</span>+<span class="number">36</span>]</span><br><span class="line"><span class="keyword">cmp</span> <span class="built_in">cl</span>,<span class="number">0xd</span></span><br><span class="line"><span class="keyword">jz</span> .is_carriage_return</span><br><span class="line"><span class="keyword">cmp</span> <span class="built_in">cl</span>,<span class="number">0xa</span></span><br><span class="line"><span class="keyword">jz</span> .is_line_feed</span><br><span class="line"><span class="keyword">cmp</span> <span class="built_in">cl</span>,<span class="number">0x8</span></span><br><span class="line"><span class="keyword">jz</span> .is_backspace</span><br><span class="line"><span class="keyword">jmp</span> .put_other</span><br><span class="line"></span><br><span class="line"><span class="symbol">.is_backspace:</span></span><br><span class="line"><span class="keyword">dec</span> <span class="built_in">bx</span>   <span class="comment">;光标位置减一</span></span><br><span class="line"><span class="keyword">shl</span> <span class="built_in">bx</span>,<span class="number">1</span>    <span class="comment">;左移一位，bx乘二得到光标处字符所在为内存地址。</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">word</span> [<span class="built_in">gs</span>:<span class="built_in">bx</span>],<span class="number">0</span>   <span class="comment">;将这一个字符为位置清零包括颜色属性</span></span><br><span class="line"><span class="keyword">shr</span> <span class="built_in">bx</span>,<span class="number">1</span>    <span class="comment">;bx恢复原状</span></span><br><span class="line"><span class="keyword">jmp</span> .set_cursor</span><br><span class="line"></span><br><span class="line"><span class="symbol">.put_other:</span></span><br><span class="line"><span class="keyword">shl</span> <span class="built_in">bx</span>,<span class="number">1</span></span><br><span class="line"><span class="keyword">mov</span> [<span class="built_in">gs</span>:<span class="built_in">bx</span>],<span class="built_in">cl</span></span><br><span class="line"><span class="keyword">inc</span> <span class="built_in">bx</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">byte</span> [<span class="built_in">gs</span>:<span class="built_in">bx</span>],<span class="number">0x07</span></span><br><span class="line"><span class="keyword">shr</span> <span class="built_in">bx</span>,<span class="number">1</span></span><br><span class="line"><span class="keyword">inc</span> <span class="built_in">bx</span></span><br><span class="line"><span class="comment">;若光标值小于2000，则表示该页现存没有写完，若超出2000，则回车换行处理</span></span><br><span class="line"><span class="keyword">cmp</span> <span class="built_in">bx</span>,<span class="number">2000</span></span><br><span class="line"><span class="keyword">jl</span> .set_cursor</span><br><span class="line"></span><br><span class="line"><span class="symbol">.is_line_feed:</span></span><br><span class="line"><span class="symbol">.is_carriage_return:</span></span><br><span class="line"><span class="keyword">xor</span> <span class="built_in">dx</span>,<span class="built_in">dx</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>,<span class="built_in">bx</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">si</span>,<span class="number">80</span></span><br><span class="line"><span class="keyword">div</span> <span class="built_in">si</span></span><br><span class="line"><span class="keyword">sub</span> <span class="built_in">bx</span>,<span class="built_in">dx</span></span><br><span class="line"><span class="comment">;先让光标回到行首再下一行，判断是否超出。</span></span><br><span class="line"><span class="symbol">.is_carriage_return_end:</span></span><br><span class="line"><span class="keyword">add</span> <span class="built_in">bx</span>,<span class="number">80</span></span><br><span class="line"><span class="keyword">cmp</span> <span class="built_in">bx</span>,<span class="number">2000</span></span><br><span class="line"><span class="symbol">.is_line_feed_end:</span></span><br><span class="line"><span class="keyword">jl</span> .set_cursor</span><br><span class="line"></span><br><span class="line"><span class="comment">;超出屏幕大小开始滚屏</span></span><br><span class="line"><span class="symbol">.roll_screen:</span></span><br><span class="line"><span class="keyword">cld</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">ecx</span>,<span class="number">960</span> <span class="comment">;共搬运 2000-80=1920个字符</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">esi</span>,<span class="number">0xb80a0</span>   <span class="comment">;第一行行首</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">edi</span>,<span class="number">0xb8000</span>   <span class="comment">;第零行行首</span></span><br><span class="line"><span class="keyword">rep</span> <span class="keyword">movsd</span></span><br><span class="line"><span class="comment">;将最后一行填充为空白</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">ebx</span>,<span class="number">3840</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">ecx</span>,<span class="number">80</span></span><br><span class="line"><span class="symbol">.cls:</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">word</span> [<span class="built_in">gs</span>:<span class="built_in">ebx</span>],<span class="number">0</span></span><br><span class="line"><span class="keyword">add</span> <span class="built_in">ebx</span>,<span class="number">2</span></span><br><span class="line"><span class="keyword">loop</span> .cls</span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">bx</span>,<span class="number">1920</span></span><br><span class="line"></span><br><span class="line"><span class="comment">;设置光标值</span></span><br><span class="line"><span class="symbol">.set_cursor:</span></span><br><span class="line"><span class="comment">;将光标设为bx值</span></span><br><span class="line">   <span class="keyword">mov</span> <span class="built_in">dx</span>, <span class="number">0x03d4</span>			  <span class="comment">;索引寄存器</span></span><br><span class="line">   <span class="keyword">mov</span> <span class="built_in">al</span>, <span class="number">0x0e</span>				  <span class="comment">;用于提供光标位置的高8位</span></span><br><span class="line">   <span class="keyword">out</span> <span class="built_in">dx</span>, <span class="built_in">al</span></span><br><span class="line">   <span class="keyword">mov</span> <span class="built_in">dx</span>, <span class="number">0x03d5</span>			  <span class="comment">;通过读写数据端口0x3d5来获得或设置光标位置 </span></span><br><span class="line">   <span class="keyword">mov</span> <span class="built_in">al</span>, <span class="number">bh</span></span><br><span class="line">   <span class="keyword">out</span> <span class="built_in">dx</span>, <span class="built_in">al</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">mov</span> <span class="built_in">dx</span>, <span class="number">0x03d4</span></span><br><span class="line">   <span class="keyword">mov</span> <span class="built_in">al</span>, <span class="number">0x0f</span></span><br><span class="line">   <span class="keyword">out</span> <span class="built_in">dx</span>, <span class="built_in">al</span></span><br><span class="line">   <span class="keyword">mov</span> <span class="built_in">dx</span>, <span class="number">0x03d5</span> </span><br><span class="line">   <span class="keyword">mov</span> <span class="built_in">al</span>, <span class="built_in">bl</span></span><br><span class="line">   <span class="keyword">out</span> <span class="built_in">dx</span>, <span class="built_in">al</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">.put_char_done:</span></span><br><span class="line">   <span class="keyword">popad</span></span><br><span class="line">   <span class="keyword">ret</span></span><br></pre></td></tr></table></figure>

<h6 id="打印字符串"><a href="#打印字符串" class="headerlink" title="打印字符串"></a>打印字符串</h6><p>在printf.h中声明函数</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">void put<span class="constructor">_str(<span class="params">char</span><span class="operator">*</span> <span class="params">message</span>)</span></span><br></pre></td></tr></table></figure>

<p>在print.s中完成函数的定义</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">global</span> put_str</span><br><span class="line"><span class="symbol">put_str:</span></span><br><span class="line"><span class="comment">;由于本函数中只用到了ebx和ecx,只备份这两个寄存器</span></span><br><span class="line">   <span class="keyword">push</span> <span class="built_in">ebx</span></span><br><span class="line">   <span class="keyword">push</span> <span class="built_in">ecx</span></span><br><span class="line">   <span class="keyword">xor</span> <span class="built_in">ecx</span>, <span class="built_in">ecx</span>		      <span class="comment">; 准备用ecx存储参数,清空</span></span><br><span class="line">   <span class="keyword">mov</span> <span class="built_in">ebx</span>, [<span class="built_in">esp</span> + <span class="number">12</span>]	      <span class="comment">; 从栈中得到待打印的字符串地址 </span></span><br><span class="line"><span class="symbol">.goon:</span></span><br><span class="line">   <span class="keyword">mov</span> <span class="built_in">cl</span>, [<span class="built_in">ebx</span>]</span><br><span class="line">   <span class="keyword">cmp</span> <span class="built_in">cl</span>, <span class="number">0</span>		      <span class="comment">; 如果处理到了字符串尾,跳到结束处返回</span></span><br><span class="line">   <span class="keyword">jz</span> .str_over</span><br><span class="line">   <span class="keyword">push</span> <span class="built_in">ecx</span>		      <span class="comment">; 为put_char函数传递参数</span></span><br><span class="line">   <span class="keyword">call</span> put_char</span><br><span class="line">   <span class="keyword">add</span> <span class="built_in">esp</span>, <span class="number">4</span>		      <span class="comment">; 回收参数所占的栈空间</span></span><br><span class="line">                        <span class="comment">;由调用者回收栈空间，C语言调用的话编译器会自动完成但是汇编语言不会，需要我们手动回收。</span></span><br><span class="line">   <span class="keyword">inc</span> <span class="built_in">ebx</span>		      <span class="comment">; 使ebx指向下一个字符</span></span><br><span class="line">   <span class="keyword">jmp</span> .goon</span><br><span class="line"><span class="symbol">.str_over:</span></span><br><span class="line">   <span class="keyword">pop</span> <span class="built_in">ecx</span></span><br><span class="line">   <span class="keyword">pop</span> <span class="built_in">ebx</span></span><br><span class="line">   <span class="keyword">ret</span></span><br></pre></td></tr></table></figure>

<h6 id="打印整数"><a href="#打印整数" class="headerlink" title="打印整数"></a>打印整数</h6><p>在printf.h中声明函数</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">put_int</span><span class="params">(<span class="keyword">uint32_t</span> num)</span></span>;</span><br></pre></td></tr></table></figure>

<p>在print.s中完成函数的定义</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">global</span> put_int</span><br><span class="line"><span class="symbol">put_int:</span></span><br><span class="line"><span class="keyword">pushad</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">ebp</span>,<span class="built_in">esp</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">eax</span>,[<span class="built_in">ebp</span>+<span class="number">36</span>]</span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">edx</span>,<span class="built_in">eax</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">edi</span>,<span class="number">7</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">ecx</span>,<span class="number">8</span>   <span class="comment">;32位数字共分为8块</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">ebx</span>,put_int_buffer</span><br><span class="line"></span><br><span class="line"><span class="symbol">.16based_4bits:</span></span><br><span class="line"><span class="keyword">and</span> <span class="built_in">edx</span>,<span class="number">0x0000000F</span></span><br><span class="line"><span class="keyword">cmp</span>,<span class="number">9</span></span><br><span class="line"><span class="keyword">jg</span> .isA2F</span><br><span class="line"><span class="keyword">add</span> <span class="built_in">edx</span>,<span class="string">&#x27;0&#x27;</span></span><br><span class="line"><span class="keyword">jmp</span> .store</span><br><span class="line"><span class="symbol">.is_A2F:</span></span><br><span class="line"><span class="keyword">sub</span> <span class="built_in">edx</span>,<span class="number">10</span></span><br><span class="line"><span class="keyword">add</span> <span class="built_in">edx</span>,<span class="string">&#x27;A&#x27;</span></span><br><span class="line"><span class="comment">;从大往小存储在缓冲区内，最后一个数字放在最高位</span></span><br><span class="line"><span class="symbol">.store:</span></span><br><span class="line"><span class="keyword">mov</span> [<span class="built_in">ebx</span>+<span class="built_in">edi</span>],<span class="built_in">dl</span></span><br><span class="line"><span class="keyword">dec</span> <span class="built_in">edi</span></span><br><span class="line"><span class="keyword">shr</span> <span class="built_in">eax</span>,<span class="number">4</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">edx</span>,<span class="number">4</span></span><br><span class="line"><span class="keyword">loop</span> .16based_4bits</span><br><span class="line"></span><br><span class="line"><span class="symbol">.ready_to_print:</span></span><br><span class="line"><span class="keyword">inc</span> <span class="built_in">edi</span></span><br><span class="line"><span class="meta">.skip_prefix_0</span>    <span class="comment">;判断是不是8位全零</span></span><br><span class="line"><span class="keyword">cmp</span> <span class="built_in">edi</span>,<span class="number">8</span></span><br><span class="line"><span class="keyword">je</span> .full0</span><br><span class="line"><span class="symbol">.go_on_skip:</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">cl</span>,[put_int_buffer+<span class="built_in">edi</span>]</span><br><span class="line"><span class="keyword">inc</span> <span class="built_in">edi</span></span><br><span class="line"><span class="keyword">cmp</span> <span class="built_in">cl</span>,<span class="string">&#x27;0&#x27;</span></span><br><span class="line"><span class="keyword">je</span> .skip_prefix_0</span><br><span class="line"><span class="keyword">dec</span> <span class="built_in">edi</span></span><br><span class="line"><span class="keyword">jmp</span> .put_each_num</span><br><span class="line"></span><br><span class="line"><span class="symbol">.full0:</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">cl</span>,<span class="string">&#x27;0&#x27;</span></span><br><span class="line"><span class="symbol">.put_each_num:</span></span><br><span class="line"><span class="keyword">push</span> <span class="built_in">ecx</span></span><br><span class="line"><span class="keyword">call</span> put_char</span><br><span class="line"><span class="keyword">add</span> <span class="built_in">esp</span>,<span class="number">4</span></span><br><span class="line"><span class="keyword">inc</span> <span class="built_in">edi</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">cl</span>,[put_int_buffer+<span class="built_in">edi</span>]</span><br><span class="line"><span class="keyword">cmp</span> <span class="built_in">edi</span>,<span class="number">8</span></span><br><span class="line"><span class="keyword">jl</span> .put_each_num</span><br><span class="line"><span class="keyword">popad</span></span><br><span class="line"><span class="keyword">ret</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>




<h4 id="杂项问题"><a href="#杂项问题" class="headerlink" title="杂项问题"></a>杂项问题</h4><ol>
<li>对于push指令，处于对齐的要求，操作数要么是16位要么是32位，所以8位操作数会被扩展为运行模式下的默认操作数宽度。实模式为16位，保护模式为32位。</li>
<li>使用伪指令 [bits 16] [bits 32] 指定编译器进行模式指定。 </li>
<li>操作数反转前缀 0x66 寻址方式反转前缀 0x67</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://myblog.cuimouren.cn/2021/05/13/gcc-%E4%BD%BF%E7%94%A8%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="崔文耀">
      <meta itemprop="description" content="Hello, here is wenyao's space, how do you come in???">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="这里是文耀的space">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="../../2021/05/13/gcc-%E4%BD%BF%E7%94%A8%E5%85%A5%E9%97%A8/" class="post-title-link" itemprop="url">gcc 使用入门</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-13 20:16:20" itemprop="dateCreated datePublished" datetime="2021-05-13T20:16:20+08:00">2021-05-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-15 17:39:49" itemprop="dateModified" datetime="2021-05-15T17:39:49+08:00">2021-05-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="../../categories/gcc/" itemprop="url" rel="index"><span itemprop="name">gcc</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="gcc-使用入门"><a href="#gcc-使用入门" class="headerlink" title="gcc 使用入门"></a>gcc 使用入门</h1><p>GCC是GUN Compiler Collection 的简称，除了编译程序之外，还包含其他的相关工具。</p>
<h4 id="程序的编译过程"><a href="#程序的编译过程" class="headerlink" title="程序的编译过程"></a>程序的编译过程</h4><p>对于GUN编译器来说，程序的编译要经过预处理、编译、汇编、连接四个阶段。</p>
<h6 id="预处理"><a href="#预处理" class="headerlink" title="预处理"></a>预处理</h6><p>输入c语言源文件 <strong>*.c</strong> ,输出中间文件 <strong>*.i</strong> ,该阶段主要处理源文件中的预处理指令</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -E <span class="keyword">test</span>.c -o <span class="keyword">test</span>.i</span><br></pre></td></tr></table></figure>

<h6 id="编译阶段"><a href="#编译阶段" class="headerlink" title="编译阶段"></a>编译阶段</h6><p>输入中间文件 <strong>*.i</strong> ,输出汇编语言文件 <strong>*.s</strong> 。</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -S <span class="keyword">test</span>.i -o <span class="keyword">test</span>.s</span><br></pre></td></tr></table></figure>

<h6 id="汇编阶段"><a href="#汇编阶段" class="headerlink" title="汇编阶段"></a>汇编阶段</h6><p>输入汇编语言源 <strong>*.s</strong> ,输出机器语言文件 <strong>*.o</strong> 。</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -c <span class="keyword">test</span>.s -o <span class="keyword">test</span>.o</span><br></pre></td></tr></table></figure>

<h6 id="连接阶段"><a href="#连接阶段" class="headerlink" title="连接阶段"></a>连接阶段</h6><p>讲输入的机器代码文件 <strong>*.o</strong> 与其他的机器代码文件和库文件汇集成一个可执行的二进制代码文件。</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc <span class="keyword">test</span>.o -o <span class="keyword">test</span></span><br></pre></td></tr></table></figure>

<h4 id="常用命令编译选项"><a href="#常用命令编译选项" class="headerlink" title="常用命令编译选项"></a>常用命令编译选项</h4><h6 id="无选项编译链接"><a href="#无选项编译链接" class="headerlink" title="无选项编译链接"></a>无选项编译链接</h6><p>用法：gcc test.c<br>作用：将 test.c 预处理、汇编、编译并链接形成可执行文件。这里未指定输出文件，默认<br>输出为 a.out。</p>
<h6 id="选项-o"><a href="#选项-o" class="headerlink" title="选项 -o"></a>选项 -o</h6><p>用法：gcc test.c -o test<br>作用：将 test.c 预处理、汇编、编译并链接形成可执行文件 test。-o 选项用来指定输出文<br>件的文件名。</p>
<h6 id="选项-E"><a href="#选项-E" class="headerlink" title="选项 -E"></a>选项 -E</h6><p>用法：gcc -E test.c -o test.i<br>作用：将 test.c 预处理输出 test.i 文件。</p>
<h6 id="选项-S"><a href="#选项-S" class="headerlink" title="选项 -S"></a>选项 -S</h6><p>用法：gcc -S test.i<br>作用：将预处理输出文件 test.i 汇编成 test.s 文件。</p>
<h6 id="选项-c"><a href="#选项-c" class="headerlink" title="选项 -c"></a>选项 -c</h6><p>用法：gcc -c test.s<br>作用：将汇编输出文件 test.s 编译输出 test.o 文件。</p>
<h6 id="无选项链接"><a href="#无选项链接" class="headerlink" title="无选项链接"></a>无选项链接</h6><p>用法：gcc test.o -o test<br>作用：将编译输出文件 test.o 链接成最终可执行文件 test。</p>
<h6 id="选项-O"><a href="#选项-O" class="headerlink" title="选项-O"></a>选项-O</h6><p>用法：gcc -O1 test.c -o test<br>作用：使用编译优化级别 1 编译程序。级别为 1~3，级别越大优化效果越好，但编译时间越<br>长。</p>
<h4 id="多源文件的编译方法"><a href="#多源文件的编译方法" class="headerlink" title="多源文件的编译方法"></a>多源文件的编译方法</h4><p>如果有多个源文件，基本上有两种编译方法：<br>[假设有两个源文件为 test.c 和 testfun.c]</p>
<ol>
<li>多个文件一起编译<br>用法：<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc testfun.c <span class="keyword">test</span>.c -o <span class="keyword">test</span></span><br></pre></td></tr></table></figure>
作用：将 testfun.c 和 test.c 分别编译后链接成 test 可执行文件。     </li>
<li>分别编译各个源文件，之后对编译后输出的目标文件链接。<br>用法：<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gcc -c testfun.c //将 testfun.c 编译成 testfun.o</span><br><span class="line">gcc -c <span class="keyword">test</span>.c //将 <span class="keyword">test</span>.c 编译成 <span class="keyword">test</span>.o</span><br><span class="line">gcc -o testfun.o <span class="keyword">test</span>.o -o <span class="keyword">test</span> //将 testfun.o 和 <span class="keyword">test</span>.o 链接成 <span class="keyword">test</span></span><br></pre></td></tr></table></figure>
以上两种方法相比较，第一中方法编译时需要所有文件重新编译，而第二种方法可以只<br>重新编译修改的文件，未修改的文件不用重新编译。</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://myblog.cuimouren.cn/2021/05/11/os-002-os-start/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="崔文耀">
      <meta itemprop="description" content="Hello, here is wenyao's space, how do you come in???">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="这里是文耀的space">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="../../2021/05/11/os-002-os-start/" class="post-title-link" itemprop="url">os 002 os start</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-11 23:19:37" itemprop="dateCreated datePublished" datetime="2021-05-11T23:19:37+08:00">2021-05-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-21 16:19:15" itemprop="dateModified" datetime="2021-05-21T16:19:15+08:00">2021-05-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="../../categories/os/" itemprop="url" rel="index"><span itemprop="name">os</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="os-002-os-start"><a href="#os-002-os-start" class="headerlink" title="os 002 os start"></a>os 002 os start</h1><h4 id="实模式下的1M内存布局"><a href="#实模式下的1M内存布局" class="headerlink" title="实模式下的1M内存布局"></a>实模式下的1M内存布局</h4><table>
<thead>
<tr>
<th>起始</th>
<th>结束</th>
<th>大小</th>
<th>用途</th>
</tr>
</thead>
<tbody><tr>
<td>FFFF0</td>
<td>FFFFF</td>
<td>16B</td>
<td>BIOS入口地址，此16字节的指令是jmp f000:e05b</td>
</tr>
<tr>
<td>F0000</td>
<td>FFFEF</td>
<td>64KB-16B</td>
<td>BIOS的范围是F0000~FFFFF共640KB</td>
</tr>
<tr>
<td>C8000</td>
<td>EFFFF</td>
<td>160KB</td>
<td>映射硬件适配器的ROM或者内存映射式IO</td>
</tr>
<tr>
<td>C0000</td>
<td>C7FFF</td>
<td>32KB</td>
<td>显示适配器BIOS</td>
</tr>
<tr>
<td>B8000</td>
<td>BFFFF</td>
<td>32KB</td>
<td>用于文本模式的显示适配器</td>
</tr>
<tr>
<td>B0000</td>
<td>B7FFF</td>
<td>32KB</td>
<td>用于黑白显示适配器</td>
</tr>
<tr>
<td>A0000</td>
<td>AFFFF</td>
<td>64KB</td>
<td>用于彩色显示适配器</td>
</tr>
<tr>
<td>9FC00</td>
<td>9FFFF</td>
<td>1KB</td>
<td>扩展BIOS数据区</td>
</tr>
<tr>
<td>7E00</td>
<td>9FBFF</td>
<td>608KB</td>
<td>可用区域</td>
</tr>
<tr>
<td>7C00</td>
<td>7DFF</td>
<td>512B</td>
<td>MBR被加载到此处，共512字节</td>
</tr>
<tr>
<td>500</td>
<td>7BFF</td>
<td>30KB</td>
<td>可用区域</td>
</tr>
<tr>
<td>400</td>
<td>4FF</td>
<td>256B</td>
<td>BIOS数据区</td>
</tr>
<tr>
<td>0</td>
<td>3FF</td>
<td>1KB</td>
<td>中断向量表IVT</td>
</tr>
</tbody></table>
<h4 id="计算机的启动过程"><a href="#计算机的启动过程" class="headerlink" title="计算机的启动过程"></a>计算机的启动过程</h4><ol>
<li>按下开机键，cs:ip被初始化为F000:FFF0，指向BIOS入口地址。</li>
<li>BIOS被加载进ROM并被映射到1MB内存的顶部（见上表）。</li>
<li>jmp f000:e05b,执行BIOS的工作。</li>
<li>BIOS的最后一项工作是校验启动盘中位于0盘0道1扇区的内容，若最后两个字节分别为0x55与0xaa，（即最后一个字的内容为0xaa55(小端字节序)）,则认为这是一个MBR程序（主引导记录），则将此512字节加载如内存0x7C00. BIOS跳转，jmp 0:7C00</li>
<li>执行MBR。</li>
<li>MBR，加载boot loader</li>
<li>boot loader加载os 内核。</li>
<li>内核执行</li>
</ol>
<h4 id="BIOS"><a href="#BIOS" class="headerlink" title="BIOS"></a>BIOS</h4><ol>
<li>BIOS本身是一个程序。BIOS的工作：检测硬件，做各种初始化工作，建立中断向量表，加载MBR。</li>
<li>BIOS中断只能用于实模式，在保护模式下不可以使用。</li>
</ol>
<h4 id="硬盘操作"><a href="#硬盘操作" class="headerlink" title="硬盘操作"></a>硬盘操作</h4><h6 id="硬盘控制器主要端口寄存器"><a href="#硬盘控制器主要端口寄存器" class="headerlink" title="硬盘控制器主要端口寄存器"></a>硬盘控制器主要端口寄存器</h6><table>
<thead>
<tr>
<th>IO端口</th>
<th></th>
<th>端口用途</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>primary通道</td>
<td>secondary通道</td>
<td>读</td>
<td>写</td>
</tr>
<tr>
<td>指令寄存器</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>0x1F0</td>
<td>0x170</td>
<td>data</td>
<td>data</td>
</tr>
<tr>
<td>0x1F1</td>
<td>0x171</td>
<td>data</td>
<td>features</td>
</tr>
<tr>
<td>0x1F2</td>
<td>0x172</td>
<td>扇区数量</td>
<td>扇区数量</td>
</tr>
<tr>
<td>0x1F3</td>
<td>0x173</td>
<td>LBA LOW</td>
<td>LBA LOW</td>
</tr>
<tr>
<td>0x1F4</td>
<td>0x174</td>
<td>LBA MID</td>
<td>LBA MID</td>
</tr>
<tr>
<td>0x1F5</td>
<td>0x175</td>
<td>LBA HIGH</td>
<td>LBA HIGH</td>
</tr>
<tr>
<td>0x1F6</td>
<td>0x176</td>
<td>device</td>
<td>device</td>
</tr>
<tr>
<td>0x1F7</td>
<td>0x177</td>
<td>status</td>
<td>command</td>
</tr>
<tr>
<td>控制寄存器</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>0x3F6</td>
<td>0x376</td>
<td>alternate status</td>
<td>device control</td>
</tr>
</tbody></table>
<blockquote>
<p>Sector count 寄存器用来指定待读取或待写入的扇区数。硬盘每完成一个扇区，就会将此寄存器的值<br>减 1，所以如果中间失败了，此寄存器中的值便是尚未完成的扇区。这是 8 位寄存器，最大值为 255，若<br>指定为 0，则表示要操作 256 个扇区。      </p>
</blockquote>
<blockquote>
<p>在读硬盘时，端口 0x1F7 或 0x177 的寄存器名称是 Status，它是 8 位宽度的寄存器，用来给出硬盘的<br>状态信息。第 0 位是 ERR 位，如果此位为 1，表示命令出错了，具体原因可见 error 寄存器。第 3 位是 data<br>request 位，如果此位为 1，表示硬盘已经把数据准备好了，主机现在可以把数据读出来。第 6 位是 DRDY，<br>表示硬盘就绪，此位是在对硬盘诊断时用的，表示硬盘检测正常，可以继续执行一些命令。第 7 位是 BSY<br>位，表示硬盘是否繁忙，如果为 1 表示硬盘正忙着，此寄存器中的其他位都无效。另外的 4 位暂不关注。      </p>
</blockquote>
<blockquote>
<p>在写硬盘时，端口 0x1F7 或 0x177 的寄存器名称是 command，和上面说过的 error 和 feature 寄存器情况<br>一样，只是用途变了，所以换了个名字表示新的用途，它和 status 寄存器是同一个。此寄存器用来存储让硬<br>盘执行的命令，只要把命令写进此寄存器，硬盘就开始工作了。主要使用了三个命令。<br>（1）identify：0xEC，即硬盘识别。<br>（2）read sector：0x20，即读扇区。<br>（3）write sector：0x30，即写扇区。   </p>
</blockquote>
<h6 id="硬盘读取步骤"><a href="#硬盘读取步骤" class="headerlink" title="硬盘读取步骤"></a>硬盘读取步骤</h6><blockquote>
<p>（1）先选择通道，往该通道的 sector count 寄存器中写入待操作的扇区数。<br>（2）往该通道上的三个 LBA 寄存器写入扇区起始地址的低 24 位。<br>（3）往 device 寄存器中写入 LBA 地址的 24～27 位，并置第 6 位为 1，使其为 LBA 模式，设置第4位，选择操作的硬盘（master 硬盘或 slave 硬盘）。<br>（4）往该通道上的 command 寄存器写入操作命令。<br>（5）读取该通道上的 status 寄存器，判断硬盘工作是否完成。<br>（6）如果以上步骤是读硬盘，进入下一个步骤。否则，完工。<br>（7）将硬盘数据读出。        </p>
</blockquote>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">;-------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">;功能:读取硬盘n个扇区</span></span><br><span class="line"><span class="symbol">rd_disk_m_16:</span>	   </span><br><span class="line"><span class="comment">;-------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">; eax=LBA扇区号</span></span><br><span class="line"><span class="comment">; ebx=将数据写入的内存地址</span></span><br><span class="line"><span class="comment">; ecx=读入的扇区数</span></span><br><span class="line">      <span class="keyword">mov</span> <span class="built_in">esi</span>,<span class="built_in">eax</span>	  <span class="comment">;备份eax</span></span><br><span class="line">      <span class="keyword">mov</span> <span class="built_in">di</span>,<span class="built_in">cx</span>		  <span class="comment">;备份cx</span></span><br><span class="line"><span class="comment">;读写硬盘:</span></span><br><span class="line"><span class="comment">;第1步：设置要读取的扇区数</span></span><br><span class="line">      <span class="keyword">mov</span> <span class="built_in">dx</span>,<span class="number">0x1f2</span></span><br><span class="line">      <span class="keyword">mov</span> <span class="built_in">al</span>,<span class="built_in">cl</span></span><br><span class="line">      <span class="keyword">out</span> <span class="built_in">dx</span>,<span class="built_in">al</span>            <span class="comment">;读取的扇区数</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">mov</span> <span class="built_in">eax</span>,<span class="built_in">esi</span>	   <span class="comment">;恢复ax</span></span><br><span class="line"></span><br><span class="line"><span class="comment">;第2步：将LBA地址存入0x1f3 ~ 0x1f6</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">;LBA地址7~0位写入端口0x1f3</span></span><br><span class="line">      <span class="keyword">mov</span> <span class="built_in">dx</span>,<span class="number">0x1f3</span>                       </span><br><span class="line">      <span class="keyword">out</span> <span class="built_in">dx</span>,<span class="built_in">al</span>                          </span><br><span class="line"></span><br><span class="line">      <span class="comment">;LBA地址15~8位写入端口0x1f4</span></span><br><span class="line">      <span class="keyword">mov</span> <span class="built_in">cl</span>,<span class="number">8</span></span><br><span class="line">      <span class="keyword">shr</span> <span class="built_in">eax</span>,<span class="built_in">cl</span></span><br><span class="line">      <span class="keyword">mov</span> <span class="built_in">dx</span>,<span class="number">0x1f4</span></span><br><span class="line">      <span class="keyword">out</span> <span class="built_in">dx</span>,<span class="built_in">al</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">;LBA地址23~16位写入端口0x1f5</span></span><br><span class="line">      <span class="keyword">shr</span> <span class="built_in">eax</span>,<span class="built_in">cl</span></span><br><span class="line">      <span class="keyword">mov</span> <span class="built_in">dx</span>,<span class="number">0x1f5</span></span><br><span class="line">      <span class="keyword">out</span> <span class="built_in">dx</span>,<span class="built_in">al</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">shr</span> <span class="built_in">eax</span>,<span class="built_in">cl</span></span><br><span class="line">      <span class="keyword">and</span> <span class="built_in">al</span>,<span class="number">0x0f</span>	   <span class="comment">;lba第24~27位</span></span><br><span class="line">      <span class="keyword">or</span> <span class="built_in">al</span>,<span class="number">0xe0</span>	   <span class="comment">; 设置7～4位为1110,表示lba模式</span></span><br><span class="line">      <span class="keyword">mov</span> <span class="built_in">dx</span>,<span class="number">0x1f6</span></span><br><span class="line">      <span class="keyword">out</span> <span class="built_in">dx</span>,<span class="built_in">al</span></span><br><span class="line"></span><br><span class="line"><span class="comment">;第3步：向0x1f7端口写入读命令，0x20 </span></span><br><span class="line">      <span class="keyword">mov</span> <span class="built_in">dx</span>,<span class="number">0x1f7</span></span><br><span class="line">      <span class="keyword">mov</span> <span class="built_in">al</span>,<span class="number">0x20</span>                        </span><br><span class="line">      <span class="keyword">out</span> <span class="built_in">dx</span>,<span class="built_in">al</span></span><br><span class="line"></span><br><span class="line"><span class="comment">;第4步：检测硬盘状态</span></span><br><span class="line"><span class="symbol">  .not_ready:</span></span><br><span class="line">      <span class="comment">;同一端口，写时表示写入命令字，读时表示读入硬盘状态</span></span><br><span class="line">      <span class="keyword">nop</span></span><br><span class="line">      <span class="keyword">in</span> <span class="built_in">al</span>,<span class="built_in">dx</span></span><br><span class="line">      <span class="keyword">and</span> <span class="built_in">al</span>,<span class="number">0x88</span>	   <span class="comment">;第4位为1表示硬盘控制器已准备好数据传输，第7位为1表示硬盘忙</span></span><br><span class="line">      <span class="keyword">cmp</span> <span class="built_in">al</span>,<span class="number">0x08</span></span><br><span class="line">      <span class="keyword">jnz</span> .not_ready	   <span class="comment">;若未准备好，继续等。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">;第5步：从0x1f0端口读数据</span></span><br><span class="line">      <span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="built_in">di</span></span><br><span class="line">      <span class="keyword">mov</span> <span class="built_in">dx</span>, <span class="number">256</span></span><br><span class="line">      <span class="keyword">mul</span> <span class="built_in">dx</span></span><br><span class="line">      <span class="keyword">mov</span> <span class="built_in">cx</span>, <span class="built_in">ax</span>	   <span class="comment">; di为要读取的扇区数，一个扇区有512字节，每次读入一个字，</span></span><br><span class="line">			   <span class="comment">; 共需di*512/2次，所以di*256</span></span><br><span class="line">      <span class="keyword">mov</span> <span class="built_in">dx</span>, <span class="number">0x1f0</span></span><br><span class="line"><span class="symbol">  .go_on_read:</span></span><br><span class="line">      <span class="keyword">in</span> <span class="built_in">ax</span>,<span class="built_in">dx</span></span><br><span class="line">      <span class="keyword">mov</span> [<span class="built_in">bx</span>],<span class="built_in">ax</span></span><br><span class="line">      <span class="keyword">add</span> <span class="built_in">bx</span>,<span class="number">2</span>		  </span><br><span class="line">      <span class="keyword">loop</span> .go_on_read</span><br><span class="line">      <span class="keyword">ret</span></span><br></pre></td></tr></table></figure>












      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://myblog.cuimouren.cn/2021/05/11/os-001-bochs/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="崔文耀">
      <meta itemprop="description" content="Hello, here is wenyao's space, how do you come in???">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="这里是文耀的space">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="../../2021/05/11/os-001-bochs/" class="post-title-link" itemprop="url">os 001 bochs</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-05-11 20:59:35 / 修改时间：23:19:28" itemprop="dateCreated datePublished" datetime="2021-05-11T20:59:35+08:00">2021-05-11</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="../../categories/os/" itemprop="url" rel="index"><span itemprop="name">os</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="make-an-os-001"><a href="#make-an-os-001" class="headerlink" title="make an os -001"></a>make an os -001</h1><ul>
<li>积攒了这么久，终于要开始写一个操作系统了，加油。</li>
</ul>
<h4 id="bochs"><a href="#bochs" class="headerlink" title="bochs"></a>bochs</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">wget</span> https://cfhcable.dl.sourceforge.net/project/bochs/bochs/<span class="number">2</span>.<span class="number">6</span>.<span class="number">2</span>/bochs-<span class="number">2</span>.<span class="number">6</span>.<span class="number">2</span>.tar.gz</span><br></pre></td></tr></table></figure>
<ul>
<li>解压进入目录中</li>
<li>configure</li>
</ul>
<blockquote>
<p>./configure –prefix=/lib/bochs –enable-debugger –enable-disasm  –enable-iodebug  –enable-x86-debugger  –with-x –with-x11</p>
</blockquote>
<ul>
<li><p>make<br>make会出现lpthread未链接的信息，则添加以下内容。<br>修改Makefile 在93行加入以下信息</p>
<blockquote>
<p>./configure –prefix=/lib/bochs –enable-debugger –enable-disasm  –enable-iodebug  –enable-x86-debugger  –with-x –with-x11<br>191行与192行改为</p>
<p>$(LIBS) \    </p>
<pre><code>   -lpthread
</code></pre>
</blockquote>
</li>
<li><p>make install</p>
</li>
<li><p>Makefile的示例如下<br><a href="/file/bochs/Makefile">makefile</a></p>
</li>
<li><p>配置bochs的启动选项<br><a href="/file/bochs/conf">conf</a></p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Bochs配置文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 机器内存: 32MB</span></span><br><span class="line">megs: 32</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对应真实机器的bios</span></span><br><span class="line">romimage: <span class="attribute">file</span>=/lib/bochs/share/bochs/BIOS-bochs-latest</span><br><span class="line"><span class="comment"># 对应真实机器的VGA bios</span></span><br><span class="line">vgaromimage: <span class="attribute">file</span>=/lib/bochs/share/bochs/VGABIOS-lgpl-latest</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动方式</span></span><br><span class="line">boot: disk</span><br><span class="line"></span><br><span class="line">log: bochs.out</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭鼠标</span></span><br><span class="line">mouse: <span class="attribute">enabled</span>=0</span><br><span class="line">keyboard:<span class="attribute">keymap</span>=/lib/bochs/share/bochs/keymaps/x11-pc-us.map</span><br><span class="line"><span class="comment"># 硬盘设置</span></span><br><span class="line"></span><br><span class="line">ata0: <span class="attribute">enabled</span>=1, <span class="attribute">ioaddr1</span>=0x1f0, <span class="attribute">ioaddr2</span>=0x3f0, <span class="attribute">irq</span>=14</span><br><span class="line">ata0-master: <span class="attribute">type</span>=disk, <span class="attribute">path</span>=<span class="string">&quot;hd60M.img&quot;</span>, <span class="attribute">mode</span>=flat, <span class="attribute">cylinders</span>=121, <span class="attribute">heads</span>=16, <span class="attribute">spt</span>=63</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>添加环境变量<br>在 <strong>/etc/profile</strong> 的最后一行添加</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">export</span> <span class="attribute">PATH</span>=/lib/bochs/bin:$PATH</span><br></pre></td></tr></table></figure>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">source</span> <span class="regexp">/etc/</span>profile</span><br></pre></td></tr></table></figure></li>
<li><p>启动bochs</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">boshs</span></span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://myblog.cuimouren.cn/2021/05/06/linux-shell-%E7%BC%96%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="崔文耀">
      <meta itemprop="description" content="Hello, here is wenyao's space, how do you come in???">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="这里是文耀的space">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="../../2021/05/06/linux-shell-%E7%BC%96%E7%A8%8B/" class="post-title-link" itemprop="url">linux shell 编程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-06 09:44:16" itemprop="dateCreated datePublished" datetime="2021-05-06T09:44:16+08:00">2021-05-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-09-10 17:59:42" itemprop="dateModified" datetime="2021-09-10T17:59:42+08:00">2021-09-10</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="../../categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="../../categories/linux/shell/" itemprop="url" rel="index"><span itemprop="name">shell</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="linux-shell-编程"><a href="#linux-shell-编程" class="headerlink" title="linux shell 编程"></a>linux shell 编程</h1><ul>
<li>最近在用Linux倒腾一些东西，发现好多东西都可以使用写成一个shell脚本来简化，所以学习一下shell.</li>
</ul>
<h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#! /bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;hello,world!&quot;</span></span><br></pre></td></tr></table></figure>
<h4 id="shell-变量"><a href="#shell-变量" class="headerlink" title="shell 变量"></a>shell 变量</h4> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//注意不能加空格</span></span><br><span class="line">myname=<span class="string">&quot;cuiwenyao&quot;</span></span><br><span class="line">echo $&#123;myname&#125;</span><br><span class="line">hername=<span class="string">&quot;qinmengyao&quot;</span></span><br><span class="line">echo $&#123;myname&#125; <span class="string">&quot;love&quot;</span> $&#123;hername&#125;</span><br><span class="line"><span class="comment">//字符串拼接</span></span><br><span class="line"><span class="built_in">string</span>=<span class="string">&quot;$&#123;myname&#125; &quot;</span>love<span class="string">&quot; $&#123;hername&#125;&quot;</span></span><br><span class="line">echo <span class="built_in">string</span></span><br><span class="line"><span class="comment">//获取长度</span></span><br><span class="line">echo $&#123;<span class="meta">#myname&#125;</span></span><br><span class="line"><span class="comment">//提取字串</span></span><br><span class="line"><span class="built_in">string</span>=$&#123;myname:<span class="number">1</span>:<span class="number">2</span>&#125;</span><br><span class="line">echo <span class="built_in">string</span></span><br></pre></td></tr></table></figure>

<h4 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h4><ul>
<li>bash 只支持一维数组。</li>
<li>shell用小括号表示数组，数组元素用空格分开。</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">myarray=(<span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span>)</span><br><span class="line">echo $&#123;myarray[<span class="number">0</span>]&#125;</span><br><span class="line">myarray[<span class="number">0</span>]=<span class="number">10</span></span><br><span class="line">echo $&#123;myarray[<span class="number">0</span>]&#125;</span><br><span class="line"><span class="comment">//获取所有元素</span></span><br><span class="line">echo $&#123;myarray[@]&#125;</span><br><span class="line"><span class="comment">//获取数组长度</span></span><br><span class="line">echo $&#123;<span class="meta">#myarray[@]&#125;</span></span><br><span class="line">echo $&#123;<span class="meta">#myarray[*]&#125;</span></span><br><span class="line"><span class="comment">//获取单个元素的长度</span></span><br><span class="line">echo $&#123;<span class="meta">#myarray[0]&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h4><table>
<thead>
<tr>
<th>运算符</th>
<th>说明</th>
<th>举例</th>
</tr>
</thead>
<tbody><tr>
<td>+</td>
<td>加法</td>
<td>`expr $a + $b`</td>
</tr>
<tr>
<td>-</td>
<td>减法</td>
<td>`expr $a - $b`</td>
</tr>
<tr>
<td>*</td>
<td>乘法</td>
<td>`expr $a * $b`</td>
</tr>
<tr>
<td>/</td>
<td>除法</td>
<td>`expr $a / $b`</td>
</tr>
<tr>
<td>%</td>
<td>取余</td>
<td>`expr $a % $b`</td>
</tr>
<tr>
<td>=</td>
<td>赋值</td>
<td>`expr $a = $b`</td>
</tr>
<tr>
<td>==</td>
<td>相等。</td>
<td>`expr $a == $b`</td>
</tr>
<tr>
<td>!=</td>
<td>不相等。</td>
<td>`expr $a != $b`</td>
</tr>
</tbody></table>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#! /bin/bash</span><br><span class="line">a=<span class="number">10</span></span><br><span class="line">b=<span class="number">20</span></span><br><span class="line">r=`expr $&#123;a&#125; + $&#123;b&#125;`</span><br><span class="line">echo $&#123;r&#125;</span><br><span class="line">r=`expr $&#123;a&#125; - $&#123;b&#125;`</span><br><span class="line">echo $&#123;r&#125;</span><br><span class="line">r=`expr $&#123;a&#125; \* $&#123;b&#125;`</span><br><span class="line">echo $&#123;r&#125;</span><br><span class="line">r=`expr $&#123;a&#125; / $&#123;b&#125;`</span><br><span class="line">echo $&#123;r&#125;</span><br><span class="line">r=`expr $&#123;a&#125; % $&#123;b&#125;`</span><br><span class="line">echo $&#123;r&#125;</span><br></pre></td></tr></table></figure>
<h6 id="关系运算符"><a href="#关系运算符" class="headerlink" title="关系运算符"></a>关系运算符</h6><table>
<thead>
<tr>
<th>运算符</th>
<th>说明</th>
<th>举例</th>
</tr>
</thead>
<tbody><tr>
<td>-eq</td>
<td>相等</td>
<td>[${a} -eq ${b}]</td>
</tr>
<tr>
<td>-ne</td>
<td>不相等</td>
<td>[${a} -ne ${b}]</td>
</tr>
<tr>
<td>-gt</td>
<td>大于</td>
<td>[${a} -gt ${b}]</td>
</tr>
<tr>
<td>-lt</td>
<td>小于</td>
<td>[${a} -lt ${b}]</td>
</tr>
<tr>
<td>-ge</td>
<td>大于等于</td>
<td>[${a} -ge ${b}]</td>
</tr>
<tr>
<td>-le</td>
<td>小于等于</td>
<td>[${a} -le ${b}]</td>
</tr>
<tr>
<td>!</td>
<td>非</td>
<td>[！false]</td>
</tr>
<tr>
<td>-o</td>
<td>或</td>
<td>[${a} -lt 20 -o ${b} -gt 100]</td>
</tr>
<tr>
<td>-a</td>
<td>与</td>
<td>[${a} -lt 20 -a ${b} -gt 100]</td>
</tr>
<tr>
<td>||</td>
<td>或</td>
<td>[[${a} -lt 20 || ${b} -gt 100]]</td>
</tr>
<tr>
<td>&amp;&amp;</td>
<td>与</td>
<td>[[${a} -lt 20 &amp;&amp; ${b} -gt 100]]</td>
</tr>
</tbody></table>
<h6 id="字符串运算符"><a href="#字符串运算符" class="headerlink" title="字符串运算符"></a>字符串运算符</h6><table>
<thead>
<tr>
<th>运算符</th>
<th>说明</th>
<th>举例</th>
</tr>
</thead>
<tbody><tr>
<td>=</td>
<td>检测两个字符串是否相等，相等返回 true。</td>
<td>[ $a = $b ] 返回 false。</td>
</tr>
<tr>
<td>!=</td>
<td>检测两个字符串是否相等，不相等返回 true。</td>
<td>[ $a != $b ] 返回 true。</td>
</tr>
<tr>
<td>-z</td>
<td>检测字符串长度是否为0，为0返回 true。</td>
<td>[ -z $a ] 返回 false。</td>
</tr>
<tr>
<td>-n</td>
<td>检测字符串长度是否为0，不为0返回 true。</td>
<td>[ -n $a ] 返回 true。</td>
</tr>
<tr>
<td>str</td>
<td>检测字符串是否为空，不为空返回 true。</td>
<td>[ $a ] 返回 true。</td>
</tr>
</tbody></table>
<h6 id="文件测试运算符"><a href="#文件测试运算符" class="headerlink" title="文件测试运算符"></a>文件测试运算符</h6><table>
<thead>
<tr>
<th>运算符</th>
<th>说明</th>
<th>举例</th>
</tr>
</thead>
<tbody><tr>
<td>-b</td>
<td>是否是块设备文件</td>
<td>[ -b $file ]</td>
</tr>
<tr>
<td>-c</td>
<td>是否是字符设备文件</td>
<td>[ -c $file ]</td>
</tr>
<tr>
<td>-d</td>
<td>是否是目录</td>
<td>[ -d $file ]</td>
</tr>
<tr>
<td>-f</td>
<td>是否是普通文件（既不是目录，也不是设备文件）</td>
<td>[ -f $file ]</td>
</tr>
<tr>
<td>-g</td>
<td>是否设置了 SGID 位</td>
<td>[ -g $file ]</td>
</tr>
<tr>
<td>-k</td>
<td>是否设置了粘着位</td>
<td>[ -k $file ]</td>
</tr>
<tr>
<td>-p</td>
<td>是否是有名管道</td>
<td>[ -p $file ]</td>
</tr>
<tr>
<td>-u</td>
<td>是否设置了 SUID 位</td>
<td>[ -u $file ]</td>
</tr>
<tr>
<td>-r</td>
<td>文件是否可读</td>
<td>[ -r $file ]</td>
</tr>
<tr>
<td>-w</td>
<td>是否可写</td>
<td>[ -w $file ]</td>
</tr>
<tr>
<td>-x</td>
<td>是否可执行</td>
<td>[ -x $file ]</td>
</tr>
<tr>
<td>-s</td>
<td>是否为空</td>
<td>[ -s $file ]</td>
</tr>
<tr>
<td>-e</td>
<td>检测文件（包括目录）是否存在</td>
<td>[ -e $file ]</td>
</tr>
</tbody></table>
<h4 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h4><ul>
<li>shell的流程不可为空。<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#! /bin/bash</span></span><br><span class="line">num1=$[2*4]</span><br><span class="line">num2=$[1+5]</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> $[num1] -eq 8</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&#x27;两个数字相等!&#x27;</span></span><br><span class="line"><span class="keyword">elif</span> <span class="built_in">test</span> $[num1] -lt $[num2]</span><br><span class="line"><span class="keyword">then</span> </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&#x27;两个数字不相等!&#x27;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&#x27;this is else&#x27;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">array=(1 2 3 4)</span><br><span class="line"><span class="keyword">for</span> var <span class="keyword">in</span> <span class="variable">$&#123;array[@]&#125;</span></span><br><span class="line"><span class="keyword">do</span> </span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$&#123;var&#125;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;while 测试 1&quot;</span></span><br><span class="line">var=5</span><br><span class="line"><span class="keyword">while</span> (( <span class="variable">$&#123;var&#125;</span>&lt;=10 ))</span><br><span class="line"><span class="keyword">do</span> </span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$&#123;var&#125;</span></span><br><span class="line">    var=`expr <span class="variable">$&#123;var&#125;</span> + 1`</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;while 测试 2&quot;</span></span><br><span class="line">var=5</span><br><span class="line"><span class="keyword">while</span> <span class="built_in">test</span> <span class="variable">$&#123;var&#125;</span> -ne 10</span><br><span class="line"><span class="keyword">do</span> </span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$&#123;var&#125;</span></span><br><span class="line">    <span class="built_in">let</span> <span class="string">&quot;var++&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;while 测试 3&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;按下ctrl+d退出&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;输入a,b的值,我会帮你输出和&quot;</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> a b</span><br><span class="line"><span class="keyword">do</span> </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">test</span> <span class="variable">$&#123;a&#125;</span> -eq 10 </span><br><span class="line">    <span class="keyword">then</span> </span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;退出&quot;</span></span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="built_in">echo</span> `expr <span class="variable">$&#123;a&#125;</span> + <span class="variable">$&#123;b&#125;</span>`</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;until 测试 1&quot;</span></span><br><span class="line">var=0</span><br><span class="line">until <span class="built_in">test</span> <span class="variable">$&#123;var&#125;</span> -eq 10</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$&#123;var&#125;</span></span><br><span class="line">    var=`expr <span class="variable">$&#123;var&#125;</span> + 1`</span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$&#123;var&#125;</span></span><br><span class="line">    <span class="built_in">let</span> <span class="string">&quot;var++&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;case 测试 1&quot;</span></span><br><span class="line">var=1</span><br><span class="line"><span class="keyword">case</span> <span class="variable">$&#123;var&#125;</span> <span class="keyword">in</span></span><br><span class="line">1)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">    ;;</span><br><span class="line">2) </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;2&quot;</span></span><br><span class="line">    ;;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="shell-函数"><a href="#shell-函数" class="headerlink" title="shell 函数"></a>shell 函数</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="function"><span class="title">fun</span></span>()&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;这个函数会对三个数字进行相加运算...&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;输入第一个数字: &quot;</span></span><br><span class="line">    <span class="built_in">read</span> aNum</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;输入第二个数字: &quot;</span></span><br><span class="line">    <span class="built_in">read</span> anotherNum</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;两个数字分别为 <span class="variable">$aNum</span> 和 <span class="variable">$anotherNum</span> !&quot;</span></span><br><span class="line">    <span class="built_in">return</span> $((<span class="variable">$&#123;aNum&#125;</span>+<span class="variable">$&#123;anotherNum&#125;</span>+<span class="variable">$&#123;1&#125;</span>))</span><br><span class="line">&#125;</span><br><span class="line">fun 10</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;三个数字之和为 $? !&quot;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>参数处理</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>$1</td>
<td>显示第一个参数</td>
</tr>
<tr>
<td>$#</td>
<td>传递到脚本的参数个数</td>
</tr>
<tr>
<td>$*</td>
<td>以一个单字符串显示所有向脚本传递的参数</td>
</tr>
<tr>
<td>$$</td>
<td>脚本运行的当前进程ID号</td>
</tr>
<tr>
<td>$!</td>
<td>后台运行的最后一个进程的ID号</td>
</tr>
<tr>
<td>$@</td>
<td>与$*相同，但是使用时加引号，并在引号中返回每个参数。</td>
</tr>
<tr>
<td>$-</td>
<td>显示Shell使用的当前选项，与set命令功能相同。</td>
</tr>
<tr>
<td>$?</td>
<td>显示最后命令的退出状态。0表示没有错误，其他任何值表明有错误。</td>
</tr>
</tbody></table>
<h4 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h4><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">. <span class="keyword">test</span>.<span class="keyword">sh</span></span><br><span class="line">source <span class="keyword">test</span>.<span class="keyword">sh</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://myblog.cuimouren.cn/2021/04/25/use-nginx-on-ubuntu-18-04/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="崔文耀">
      <meta itemprop="description" content="Hello, here is wenyao's space, how do you come in???">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="这里是文耀的space">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="../../2021/04/25/use-nginx-on-ubuntu-18-04/" class="post-title-link" itemprop="url">use nginx on ubuntu 18.04</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-25 17:24:12" itemprop="dateCreated datePublished" datetime="2021-04-25T17:24:12+08:00">2021-04-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-08 15:14:27" itemprop="dateModified" datetime="2021-05-08T15:14:27+08:00">2021-05-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="../../categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="../../categories/linux/nginx/" itemprop="url" rel="index"><span itemprop="name">nginx</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="nginx-on-ubuntu-18-04"><a href="#nginx-on-ubuntu-18-04" class="headerlink" title="nginx on ubuntu 18.04"></a>nginx on ubuntu 18.04</h1><h4 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h4><ol>
<li><a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-install-nginx-on-ubuntu-18-04">How To Install Nginx on Ubuntu 18.04</a></li>
<li><a target="_blank" rel="noopener" href="http://nginx.org/en/docs/beginners_guide.html">nginx beginner’s guide</a><h4 id="introduction"><a href="#introduction" class="headerlink" title="introduction"></a>introduction</h4></li>
</ol>
<ul>
<li>nginx is one of the most popular web servers in the world and is responsible for hosting some of the largest and high-traffic sites on the internet. it is more resource-friendly than apache in most cases and can be used as a web server or reverse proxy.</li>
<li>in this guild, we will discuss how to install nginx on my ubuntu 18.04 server.<h4 id="step1-install-nginx"><a href="#step1-install-nginx" class="headerlink" title="step1 (install nginx)"></a>step1 (install nginx)</h4></li>
<li>because nginx is available in ubuntu’s default repositories, it is possible to install it from these repositories using the apt packaging system.</li>
<li>it may be the first interaction with the apt packaging system, so i’d like to update my local package index so that i have access to the most recent package listings. afterwards, i can install nginx<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt update</span><br><span class="line">apt <span class="keyword">install</span> nginx</span><br></pre></td></tr></table></figure></li>
<li>after accepting the procedure, apt will install nginx and any required dependencies to my server.<h4 id="step2-adjusting-the-firewall"><a href="#step2-adjusting-the-firewall" class="headerlink" title="step2 (adjusting the firewall)"></a>step2 (adjusting the firewall)</h4></li>
<li>before testing nginx, the firewall software needs to be adjusted to allow access to the service. nginx registers itself as a service with ufw upon installation, making it straightforward to allow nginx access.</li>
<li>list the application configurations that ufw know how to work with by typing:<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ufw app list</span></span><br></pre></td></tr></table></figure></li>
<li>you should get a listing of the application profiles.<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Available applications:</span><br><span class="line">  Nginx <span class="literal">Full</span></span><br><span class="line">  Nginx HTTP</span><br><span class="line">  Nginx HTTPS</span><br><span class="line">  OpenSSH</span><br></pre></td></tr></table></figure></li>
<li>Nginx Full: this profile opens both port 80(normal, unencrypted web traffic) and port 443(TLS/SSL encrypted traffic)</li>
<li>Nginx HTTP: this profile opens only the port 80.</li>
<li>Nginx HTTPS: this profile opens only port 443.</li>
<li>it is recommended that you enable the most restrictive profile that will still allow the traffic you have configured. however, i have not configured SSL for my server, i will only need to allow traffic on port 80.<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ufw <span class="builtin-name">enable</span> <span class="string">&quot;Nginx HTTP&quot;</span></span><br></pre></td></tr></table></figure>
<h4 id="checking-your-web-server"><a href="#checking-your-web-server" class="headerlink" title="checking your web server"></a>checking your web server</h4></li>
<li>at the end of the installation process, ubuntu starts nginx, the web server should already be up and running. we can check with the systemd init system to make sure the service is running by typing:<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">systemctl status nginx</span></span><br></pre></td></tr></table></figure></li>
<li>output:<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">● nginx.service - A high performance web <span class="keyword">server</span> <span class="keyword">and</span> a <span class="keyword">reverse</span> proxy <span class="keyword">server</span></span><br><span class="line">   Loaded: loaded (/lib/systemd/<span class="keyword">system</span>/nginx.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: active (running) since Sun <span class="number">2021</span><span class="number">-04</span><span class="number">-25</span> <span class="number">17</span>:<span class="number">46</span>:<span class="number">15</span> CST; <span class="number">7</span>min ago</span><br><span class="line">     Docs: man:nginx(<span class="number">8</span>)</span><br><span class="line">  Process: <span class="number">1156</span> ExecStart=/usr/sbin/nginx -g daemon <span class="keyword">on</span>; master_process <span class="keyword">on</span>; (code=exited, s</span><br><span class="line">  Process: <span class="number">1039</span> ExecStartPre=/usr/sbin/nginx -t -q -g daemon <span class="keyword">on</span>; master_process <span class="keyword">on</span>; (code=</span><br><span class="line"> Main PID: <span class="number">1170</span> (nginx)</span><br><span class="line">    Tasks: <span class="number">2</span> (<span class="keyword">limit</span>: <span class="number">2121</span>)</span><br><span class="line">   CGroup: /<span class="keyword">system</span>.<span class="keyword">slice</span>/nginx.service</span><br><span class="line">           ├─<span class="number">1170</span> nginx: master process /usr/sbin/nginx -g daemon <span class="keyword">on</span>; master_process <span class="keyword">on</span>;</span><br><span class="line">           └─<span class="number">1176</span> nginx: worker process</span><br><span class="line"></span><br><span class="line">Apr <span class="number">25</span> <span class="number">17</span>:<span class="number">46</span>:<span class="number">15</span> VM<span class="number">-4</span><span class="number">-14</span>-ubuntu systemd[<span class="number">1</span>]: Starting A high performance web <span class="keyword">server</span> <span class="keyword">and</span> a re</span><br><span class="line">Apr <span class="number">25</span> <span class="number">17</span>:<span class="number">46</span>:<span class="number">15</span> VM<span class="number">-4</span><span class="number">-14</span>-ubuntu systemd[<span class="number">1</span>]: nginx.service: Failed <span class="keyword">to</span> parse PID <span class="keyword">from</span> file /r</span><br><span class="line">Apr <span class="number">25</span> <span class="number">17</span>:<span class="number">46</span>:<span class="number">15</span> VM<span class="number">-4</span><span class="number">-14</span>-ubuntu systemd[<span class="number">1</span>]: Started A high performance web <span class="keyword">server</span> <span class="keyword">and</span> a rev</span><br><span class="line">lines <span class="number">1</span><span class="number">-15</span>/<span class="number">15</span> (<span class="keyword">END</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>as you can see above, the service appears to have started successfully, however, the best way to test this is to actually request a page from nginx.</li>
<li>you can access the default nginx landing page to confirm that the software is running properly by navigating to your server’s ip address. you can get your ipv4 address on the internet by typing:<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">curl</span> -<span class="number">4</span> icanhazip.com</span><br></pre></td></tr></table></figure></li>
<li>enter it to your browser’s address bar, you will see the default nginx landing page.<h4 id="step4-manager-the-nginx-process"><a href="#step4-manager-the-nginx-process" class="headerlink" title="step4 (manager the nginx process)"></a>step4 (manager the nginx process)</h4><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">systemctl start nginx</span><br><span class="line">systemctl stop nginx</span><br><span class="line">systemctl restart nginx</span><br><span class="line">systemctl reload nginx</span><br><span class="line">systemctl enable nginx</span><br><span class="line">systemctl disable nginx</span><br></pre></td></tr></table></figure>
<h4 id="step5-setting-up-server-blocks"><a href="#step5-setting-up-server-blocks" class="headerlink" title="step5 (setting up server blocks)"></a>step5 (setting up server blocks)</h4></li>
<li>when using the nginx web server, server blocks(similar to virtual hosts in apache)can be used to encapsulate configuration details and host more than one domain form a single server. i will set a domain called nginx.cuimouren.cn to test this.</li>
<li>nginx on ubuntu has one server block enabled by default that is configured to serve documents out of a directory at /var/www/html. while this works well for one single site, it can become unwieldly if you are hosting multiple sites. instead of modifying /var/www/html, let’s create a directory structure within /var/www for my nginx.cuimouren.cn site, leaving /var/www/html in place as the default directory to be served if a client request does not match any other sites.</li>
<li>create a directory for nginx.cuimouren.cn, using -p flag to create any necessary parent directories. i will using my github page as a test.<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p <span class="regexp">/var/</span>www/nginx.cuimouren.cn</span><br><span class="line">cd <span class="regexp">/var/</span>www/nginx.cuimouren.cn</span><br><span class="line">git clone https:<span class="regexp">//gi</span>thub.com<span class="regexp">/yishuilingbo/yi</span>shuilingbo.github.io.git</span><br><span class="line">cd yishuilingbo.github.io</span><br><span class="line">mv * ../</span><br><span class="line">rm -rf yishuilingbo.github.io</span><br></pre></td></tr></table></figure></li>
<li>in order for nginx to server this content, it’s necessary to create a server block with the correct directives, instead of modifying the default configuration file directly, let’s make a new one.<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>nginx<span class="regexp">/sites-available/</span>nginx.cuimouren.cn</span><br></pre></td></tr></table></figure></li>
<li>write like these<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">        <span class="attribute">listen</span> [::]:<span class="number">80</span>;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">root</span> /var/www/nginx.cuimouren.cn;</span><br><span class="line">        <span class="attribute">index</span> index.html index.htm index.nginx-debian.html;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">server_name</span> nginx.cuimouren.cn www.nginx.cuimouren.cn;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">location</span> / &#123;</span><br><span class="line">                <span class="attribute">try_files</span> $uri $uri/ =<span class="number">404</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>enable the file by creating a link form it to the “sites-enabled” directory, which nginx reads from during startup<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s <span class="regexp">/etc/</span>nginx<span class="regexp">/sites-available/</span>nginx.cuimouren.cn <span class="regexp">/etc/</span>nginx<span class="regexp">/sites-enabled/</span></span><br></pre></td></tr></table></figure></li>
<li>test to make sure that there are no syntax error in any nginx files.<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">nginx -t</span></span><br></pre></td></tr></table></figure></li>
<li>restart nginx<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">systemctl restart nginx</span></span><br></pre></td></tr></table></figure></li>
<li>look my site on the browser.<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx.cuimouren.<span class="literal">cn</span></span><br></pre></td></tr></table></figure>
<h4 id="step6-securing-my-domain"><a href="#step6-securing-my-domain" class="headerlink" title="step6 securing my domain"></a>step6 securing my domain</h4></li>
<li>in this section, i will secure my domain using a let’s encrypt tls sertificate, which i will provision using certbot.<br>to install the lastest version of sertbot, i will need to add its package repository to my server by running the following command:<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">add</span>-apt-repository ppa:certbot/certbot</span><br><span class="line"><span class="comment">#install its nginx plugin</span></span><br><span class="line">apt install python-sertbot-nginx</span><br><span class="line">ufw allow <span class="keyword">https</span></span><br><span class="line">ufw reload</span><br><span class="line">certbot <span class="comment">--nginx -d mydomain</span></span><br></pre></td></tr></table></figure></li>
<li>i recommand to use the second option in order to maximize security.</li>
</ul>
<h4 id="step7-getting-familiar-with-important-nginx-files-and-directories"><a href="#step7-getting-familiar-with-important-nginx-files-and-directories" class="headerlink" title="step7 (getting familiar with important nginx files and directories)"></a>step7 (getting familiar with important nginx files and directories)</h4><ul>
<li>now that you know how to manage the nginx service itself, you should take a few minutes to familiarize yourself with a few important directories and files.</li>
</ul>
<h6 id="content"><a href="#content" class="headerlink" title="content"></a>content</h6><ul>
<li><strong>/var/www/html</strong><blockquote>
<p>the actual web content, which by default only consists of the nginx page you saw earlier, is served out of the <strong>/var/www/html</strong> directory, this can be changed by altering nginx configuration files.</p>
</blockquote>
</li>
</ul>
<h6 id="server-configuration"><a href="#server-configuration" class="headerlink" title="server configuration"></a>server configuration</h6><ul>
<li><p><strong>/etc/nginx</strong></p>
<blockquote>
<p>the nginx configuration direction. all of the nginx configuration files reside here.</p>
</blockquote>
</li>
<li><p>** /etc/nginx/nginx.conf**</p>
<blockquote>
<p>the main nginx configuration file. this can be modified to make changes to the nginx global configuration.</p>
</blockquote>
</li>
<li><p><strong>/etc/nginx/sites-available</strong></p>
<blockquote>
<p>the directory where per-site server blocks can be stored. nginx will not use the configuration files found in this directory unless they are linked to the <strong>sites-enabled</strong> directory. typically, all server block configuration is done in the directory, and then enabled by linking to the other directory.</p>
</blockquote>
</li>
<li><p><strong>/etc/nginx/sites-enabled</strong></p>
<blockquote>
<p>the directory where enabled per-site server blocks are stored. typically, these are created by linking to configuration files found in the <strong>sites-available</strong> directory.</p>
</blockquote>
</li>
<li><p><strong>/etc/nginx/snippets</strong></p>
<blockquote>
<p>this directory contains configuration fragments that can be included elsewhere in the nginx configuration. potentially repeatable configuration segments are good candidates for refactoring into snippets.</p>
</blockquote>
</li>
</ul>
<h6 id="server-logs"><a href="#server-logs" class="headerlink" title="server logs"></a>server logs</h6><ul>
<li><p><strong>/var/log/nginx/access.log</strong></p>
<blockquote>
<p>every request to your web server is recorded in the log file unless nginx is configured to do otherwise.</p>
</blockquote>
</li>
<li><p><strong>/var/log/nginx/error/log</strong></p>
<blockquote>
<p>any nginx error will be recorded in this log.</p>
</blockquote>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://myblog.cuimouren.cn/2021/04/21/linux-command/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="崔文耀">
      <meta itemprop="description" content="Hello, here is wenyao's space, how do you come in???">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="这里是文耀的space">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="../../2021/04/21/linux-command/" class="post-title-link" itemprop="url">linux command</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-21 22:36:40" itemprop="dateCreated datePublished" datetime="2021-04-21T22:36:40+08:00">2021-04-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-09-10 08:35:56" itemprop="dateModified" datetime="2021-09-10T08:35:56+08:00">2021-09-10</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="../../categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="../../categories/linux/linux%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">linux基础命令学习</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="linux-command"><a href="#linux-command" class="headerlink" title="linux command"></a>linux command</h1><p>linux基础命令</p>
<p><a target="_blank" rel="noopener" href="https://linuxtools-rst.readthedocs.io/zh_CN/latest/base/index.html">参考</a></p>
<h2 id="命令帮助"><a href="#命令帮助" class="headerlink" title="命令帮助"></a>命令帮助</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">whatis command</span><br><span class="line">info command </span><br><span class="line">man command</span><br><span class="line">command --help</span><br><span class="line"></span><br><span class="line">which command #查看命令二进制文件所在位置</span><br><span class="line">whereis command #查看程序使用的位置</span><br></pre></td></tr></table></figure>

<h2 id="文件及目录管理"><a href="#文件及目录管理" class="headerlink" title="文件及目录管理"></a>文件及目录管理</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">touch [filename]</span><br><span class="line">mkdir [dirname]</span><br><span class="line">mkdir -p [dirname]</span><br><span class="line">cp [sourcefile] [desfile]</span><br><span class="line">cp -r [sourcedir] [destdir]</span><br><span class="line">cd </span><br><span class="line">pwd</span><br><span class="line">ls</span><br><span class="line">ls -lrt #按时间，以列表的形式显示</span><br><span class="line">cat -n #显示行号，显示文本</span><br><span class="line">chown #改变拥有者</span><br><span class="line">chmod </span><br><span class="line">chmod -R #递归作用于整个文件夹</span><br><span class="line">ln #硬链接 深复制</span><br><span class="line">ln -s #软链接 浅复制</span><br><span class="line">:&gt; [filename] #清空文件</span><br><span class="line">file [failename] #查看文件类型</span><br></pre></td></tr></table></figure>

<h2 id="文本处理"><a href="#文本处理" class="headerlink" title="文本处理"></a>文本处理</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">grep -n显示行号 -v反选 -i忽略大小写</span></span><br><span class="line">grep [选项][文件名]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="磁盘管理"><a href="#磁盘管理" class="headerlink" title="磁盘管理"></a>磁盘管理</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">df -h #以人性化的方式显示磁盘使用</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> tar -c：创建压缩文件 -x解压 -t查看压缩包内的文件 -z使用gzip进行压缩或者解压 -j使用bzip2进行压缩解压 -v显示过程 -f目标文件名 -P保留文件的原始权限 -p使用绝对路径来压缩 -C解压到指定目录</span></span><br><span class="line"></span><br><span class="line">tar -cvf [target] [source] #仅打包不压缩 tar -cvf 1.tar 1/</span><br><span class="line">gzip 1.tar  #压缩文件 生成 1.tar.gz</span><br><span class="line"><span class="meta">#</span><span class="bash"> 解压</span></span><br><span class="line">tar -xvf 1.tar</span><br><span class="line">tar -xzvf 1.tar.gz</span><br><span class="line"><span class="meta">#</span><span class="bash">或者</span></span><br><span class="line">gunzip 1.tar.gz</span><br><span class="line">tar -xvf 1.tar</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">dd操作简介 <span class="keyword">if</span>：输入文件 of:输出文件 count文件的块数 bs：文件每一块的大小(此大小不可以超过系统内存不然会内存不够)</span></span><br><span class="line"><span class="meta">#</span><span class="bash">eg:下面这条命令将生成一个文件 大小为2*50M</span></span><br><span class="line">dd if=/dev/zero of=dd_test count=2 bs=50M</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="进程管理"><a href="#进程管理" class="headerlink" title="进程管理"></a>进程管理</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ps -ef #查看正在运行的进程信息</span><br><span class="line">ps -ef|grep [name] #模糊查询正在运行的进程信息</span><br><span class="line">ps -ajx #以完整的格式显示所有的进程</span><br><span class="line">top #显示进程信息，并实时更新</span><br><span class="line"><span class="meta">#</span><span class="bash"> P：根据CPU使用百分比大小进行排序。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> M：根据驻留内存大小进行排序。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> i：使top不显示任何闲置或者僵死进程。</span></span><br><span class="line">lsof -i:3306 #查看端口占用</span><br><span class="line">lsof -u [username] #显示指定用户打开的文件</span><br><span class="line">lsof -c [progrocess name] #查看某进程打开的文件</span><br><span class="line">kill </span><br></pre></td></tr></table></figure>
<h2 id="性能监控"><a href="#性能监控" class="headerlink" title="性能监控"></a>性能监控</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sar -u 1 10 #显示cpu使用率，每秒钟采样一次，共采样10次</span><br><span class="line">free </span><br><span class="line">uptime</span><br></pre></td></tr></table></figure>

<h2 id="网络工具"><a href="#网络工具" class="headerlink" title="网络工具"></a>网络工具</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">netstat </span><br><span class="line">netstat -a #列出所有端口</span><br><span class="line">netstat -at #列出搜友tcp端口</span><br><span class="line">netstat -l #列出所有有监听的服务状态</span><br><span class="line"><span class="meta">#</span><span class="bash">查询某端口正在运行的程序</span></span><br><span class="line">lsof -i:[port] #得到PID</span><br><span class="line">ps -ef |grep [port] #得到程序运行信息</span><br><span class="line"></span><br><span class="line">route</span><br><span class="line">ping </span><br><span class="line">traceroute</span><br><span class="line">host [domain]</span><br><span class="line">host [ip]</span><br><span class="line">wget</span><br><span class="line">ssh username@host</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ftp/sftp</span></span><br><span class="line">sftp username@host</span><br><span class="line">get file #下载文件</span><br><span class="line">get -r file  #下载文件夹</span><br><span class="line">put file #上传文件</span><br><span class="line">put -r file #上传文件夹</span><br><span class="line">ls #显示host文件</span><br><span class="line">cd #更改host路径</span><br><span class="line">lls #显示本机文件</span><br><span class="line">lcd #更改本机路径</span><br><span class="line"></span><br><span class="line">scp [OPTION] [user@]SRC_HOST:]file1 [user@]DEST_HOST:]file2</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">useradd -m username </span><br><span class="line">passwd username</span><br><span class="line">userdel -r username</span><br><span class="line">su username</span><br><span class="line"></span><br><span class="line">groups [username] #查看用户所处的组</span><br><span class="line">usermod -G groupname username #将用户加入到组中,一个用户可属于不同组</span><br><span class="line">usermod -g groupname username #将用户加入到组中,并从原来的组中删去</span><br><span class="line"></span><br><span class="line">chmod userMark(+|-)PermissionsMark</span><br><span class="line">chmod u+x file</span><br><span class="line"><span class="meta">#</span><span class="bash"> u：用户</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> g：组</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> o：其它用户</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> a：所有用户</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> r:读</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> w：写</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> x：执行</span></span><br><span class="line"></span><br><span class="line">chown username file</span><br><span class="line">chown -R  username dir</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>使用ls -l可查看文件的属性字段，文件属性字段总共有10个字母组成，第一个字母表示文件类型，如果这个字母是一个减号”-”,则说明该文件是一个普通文件。字母”d”表示该文件是一个目录，字母”d”,是dirtectory(目录)的缩写。 后面的9个字母为该文件的权限标识，3个为一组，分别表示文件所属用户、用户所在组、其它用户的读写和执行权限</p>
</blockquote>
<blockquote>
<p>使用三位八进制数字的形式来表示权限，第一位指定属主的权限，第二位指定组权限，第三位指定其他用户的权限，每位通过4(读)、2(写)、1(执行)三种数值的和来确定权限。如6(4+2)代表有读写权，7(4+2+1)有读、写和执行的权限。</p>
</blockquote>
<h2 id="系统管理"><a href="#系统管理" class="headerlink" title="系统管理"></a>系统管理</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">uname -a </span><br><span class="line">lsb_release -a</span><br><span class="line">cat /proc/cpuinfo</span><br><span class="line">cat /proc/meminfo</span><br><span class="line">date</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://myblog.cuimouren.cn/2021/04/21/Initial-Server-Setup-with-Ubuntu/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="崔文耀">
      <meta itemprop="description" content="Hello, here is wenyao's space, how do you come in???">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="这里是文耀的space">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="../../2021/04/21/Initial-Server-Setup-with-Ubuntu/" class="post-title-link" itemprop="url">Initial Server Setup with Ubuntu</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-21 15:21:12" itemprop="dateCreated datePublished" datetime="2021-04-21T15:21:12+08:00">2021-04-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-23 16:08:09" itemprop="dateModified" datetime="2021-04-23T16:08:09+08:00">2021-04-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="../../categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="../../categories/linux/ubuntu/" itemprop="url" rel="index"><span itemprop="name">ubuntu</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Initial-Server-Setup-with-Ubuntu"><a href="#Initial-Server-Setup-with-Ubuntu" class="headerlink" title="Initial Server Setup with Ubuntu"></a>Initial Server Setup with Ubuntu</h1><ul>
<li>When you first create a new ubuntu 18.04 server, there are a new configuration steps that you should take early on as part of the basic setup. This will increase the security and usability of your server and will give you a solid foundation for subsequent actions.</li>
<li>This guide below demonstrates how to manually complete the steps recommended for new ubuntu 18.04 servers. Following this procedure manually can be useful to learn some basic system administration skills and as an exercise to fully understand the actions being taking on my server. As an alternative, if you wish to get up and running more quickly, you can run my initial server setup script which automates these steps.<h4 id="step-1-logging-in-as-root"><a href="#step-1-logging-in-as-root" class="headerlink" title="step 1 logging in as root"></a>step 1 logging in as root</h4></li>
<li>If you are not already connected to your server, go ahead and log in as root user using the following command, substitute server’s ip with your server’s public ip address.<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh root<span class="meta">@server</span><span class="symbol">&#x27;s</span> ip</span><br></pre></td></tr></table></figure></li>
<li>Accept the warning about host authenticity if it appears. If you are using password authentication, provide your root password to login in. If you are using an SSH key that is passphrase protected, you may be prompted to enter the passphrase the first time you use the key each session. If this is your first time logging into the server with a password, you may also be prompted to change the root password.</li>
<li><strong>about root</strong><blockquote>
<p>The root user is the administrative user in a Linux environment that has very broad privileges. Because of the heightened privileges of the root account, you are discouraged form using it on a regular basis. This is because part of the power inherent with the root account is the ability to make very destructive changes, even by accident.</p>
<p>The next step is to set up an alternative user account with a reduced scope of influence for day-to-day work. I will teach you how to gain increased privileges during the times when you need them.</p>
</blockquote>
</li>
</ul>
<h4 id="step2-creating-a-new-user"><a href="#step2-creating-a-new-user" class="headerlink" title="step2 creating a new user"></a>step2 creating a new user</h4><ul>
<li>Once you are logged in as root, we are prepared to add the new user account that we will use to log in from now on.</li>
<li>This example create a new user named wenyao<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">adduser wenyao</span></span><br></pre></td></tr></table></figure></li>
<li>You will be asked a few questions, starting with the account password.</li>
<li>Enter a strong password and, optionally, fill in any of the additional information if you would like. This is not required and you can just hit enter to skip.</li>
</ul>
<h4 id="step3-granting-administrative-privileges"><a href="#step3-granting-administrative-privileges" class="headerlink" title="step3 granting administrative privileges"></a>step3 granting administrative privileges</h4><ul>
<li>Now, we have a new user account with regular account privileges. However, we may sometimes need to do administrative tasks.</li>
<li>To avoid having to log out of our normal user and log back in as the root account, we can set up what is known as superuser or root privileges for our normal account. This allow our normal user to run commands with administrative privileges by putting the word “sudo” before each command.</li>
<li>To add these privileges to our new user, we need add the new user to the “sudo” group. By default, on ubuntu 18.04, users who belong to the “sudo” group are allow to use the “sudo” command.</li>
<li>As root, run this command to add new user to the sudo group.<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">usermod -aG sudo wenyao</span></span><br></pre></td></tr></table></figure></li>
<li>Now, when logged in as your regular user, you can type “sudo” before commands to perform actions with superuser privileges.</li>
</ul>
<h4 id="step4-setting-up-a-basic-firewall"><a href="#step4-setting-up-a-basic-firewall" class="headerlink" title="step4 setting up a basic firewall"></a>step4 setting up a basic firewall</h4><ul>
<li><p>ubuntu 18.04 servers can use the UFW firewall to make sure only connections to certain services are allowed. We can set up a basic firewall very easily using this application.</p>
</li>
<li><p>Different applications can register their profiles with UFW upon installation. These profiles allow UFW to manager these applications by name. OpenSSH, the service allowing us to connect to our server now, has a profile registered with UFW. You can see this by typing:</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ufw app list</span></span><br></pre></td></tr></table></figure></li>
<li><p>the output will looks like this:</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Available</span> applications:</span><br><span class="line">  OpenSSH</span><br></pre></td></tr></table></figure></li>
<li><p>We need make sure that the firewall allows SSH connections so that we can log back in next time. We can allow these connections by typing:</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ufw</span> <span class="literal">allow</span> OpenSSH</span><br></pre></td></tr></table></figure></li>
<li><p>Afterwards, we can enable the firewall by typing:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ufw <span class="built_in">enable</span></span><br></pre></td></tr></table></figure></li>
<li><p>You can see that SSH connections are allowed by typing:</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ufw status</span></span><br></pre></td></tr></table></figure></li>
<li><p>the output will looks like this:</p>
<figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">Status:</span> <span class="comment">active</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">To</span>                         <span class="comment">Action</span>      <span class="comment">From</span></span><br><span class="line"><span class="comment"></span>--                         --<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span>      --<span class="literal">-</span><span class="literal">-</span></span><br><span class="line"><span class="comment">OpenSSH</span>                    <span class="comment">ALLOW</span>       <span class="comment">Anywhere</span></span><br><span class="line"><span class="comment">OpenSSH</span> <span class="comment">(v6)</span>               <span class="comment">ALLOW</span>       <span class="comment">Anywhere</span> <span class="comment">(v6)</span></span><br><span class="line"><span class="comment"></span></span><br></pre></td></tr></table></figure></li>
<li><p>As the firewall is currently blocking all connections except for SSH. If you install and configure additional services, you will need to adjust the firewall setting to allow acceptable traffic in. </p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://myblog.cuimouren.cn/2021/04/21/code-server/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="崔文耀">
      <meta itemprop="description" content="Hello, here is wenyao's space, how do you come in???">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="这里是文耀的space">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="../../2021/04/21/code-server/" class="post-title-link" itemprop="url">code-server</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-21 14:47:01" itemprop="dateCreated datePublished" datetime="2021-04-21T14:47:01+08:00">2021-04-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-12-10 09:20:35" itemprop="dateModified" datetime="2021-12-10T09:20:35+08:00">2021-12-10</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="../../categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="code-server"><a href="#code-server" class="headerlink" title="code-server"></a>code-server</h1><ul>
<li>code-server is a cloud ide platform, which can enable us to code through browser anywhere. But how to set up the code-server on ubuntu 18.04</li>
<li>Eeee, to practice my English, I prefer to using English in my blog, unless there is something I can’t express by using my poor English.<h4 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h4></li>
</ul>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mkdir ~/code-server</span><br><span class="line">cd ~/code-server</span><br><span class="line">proxychains wget https:<span class="regexp">//gi</span>thub.com<span class="regexp">/cdr/</span>code-server<span class="regexp">/releases/</span>download<span class="regexp">/v3.12.0/</span>code-server-<span class="number">3.12</span>.<span class="number">0</span>-linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line">tar -xzvf code-server-<span class="number">3.12</span>.<span class="number">0</span>-linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line">mv code-server-<span class="number">3.12</span>.<span class="number">0</span>-linux-amd64 code-server</span><br><span class="line"></span><br><span class="line">rm -rf <span class="regexp">/usr/</span>lib/code-server</span><br><span class="line"></span><br><span class="line">cp -r code-server <span class="regexp">/usr/</span>lib/code-server</span><br><span class="line"></span><br><span class="line">ln -s <span class="regexp">/usr/</span>lib<span class="regexp">/code-server/</span>code-server <span class="regexp">/usr/</span>bin/code-server</span><br><span class="line"></span><br><span class="line">mkdir <span class="regexp">/var/</span>lib/code-server</span><br><span class="line"></span><br><span class="line">vi <span class="regexp">/lib/</span>systemd<span class="regexp">/system/</span>code-server.service</span><br></pre></td></tr></table></figure>
<p><strong>填入以下内容</strong></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=code-server</span><br><span class="line"><span class="attr">After</span>=nginx.service</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">Type</span>=simple</span><br><span class="line"><span class="attr">Environment</span>=PASSWORD=your_password</span><br><span class="line"><span class="attr">ExecStart</span>=/usr/bin/code-server --bind-addr <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">8080</span> --user-data-dir /var/lib/code-server --auth password</span><br><span class="line"><span class="attr">Restart</span>=always</span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br></pre></td></tr></table></figure>

<p><strong>启动</strong></p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="keyword">start</span> code-<span class="keyword">server</span></span><br><span class="line">systemctl <span class="keyword">enable</span> code-<span class="keyword">server</span></span><br><span class="line">systemctl status code-<span class="keyword">server</span></span><br></pre></td></tr></table></figure>

<p><strong>export</strong><br>使用nginx使得外网可以访问</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>nginx<span class="regexp">/sites-available/</span>code-server</span><br></pre></td></tr></table></figure>

<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">listen</span> [::]:<span class="number">80</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">server_name</span> code-server.your-domain;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">      <span class="attribute">proxy_pass</span> http://localhost:8080/;</span><br><span class="line">      <span class="attribute">proxy_set_header</span> Upgrade $http_upgrade;</span><br><span class="line">      <span class="attribute">proxy_set_header</span> Connection upgrade;</span><br><span class="line">      <span class="attribute">proxy_set_header</span> Accept-Encoding gzip;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ln -s <span class="regexp">/etc/</span>nginx<span class="regexp">/sites-available/</span>code-server <span class="regexp">/etc/</span>nginx<span class="regexp">/sites-enabled/</span>code-server</span><br><span class="line"></span><br><span class="line">nginx -t</span><br><span class="line">systemctl restart nginx</span><br></pre></td></tr></table></figure>

<p><strong>Securing Your Domain</strong></p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">add</span>-apt-repository ppa:certbot/certbot</span><br><span class="line">apt install python-certbot-nginx</span><br><span class="line">ufw allow <span class="keyword">https</span></span><br><span class="line">ufw reload</span><br><span class="line">certbot <span class="comment">--nginx -d code-server.your-domain</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id=""><a href="#" class="headerlink" title=""></a></h4><p>code-server 3.9.3之后的版本在markdown preview 时滚轮不同步。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://myblog.cuimouren.cn/2021/04/21/%E9%9B%B6%E7%A2%8E%E7%9A%84%E6%8A%80%E6%9C%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="崔文耀">
      <meta itemprop="description" content="Hello, here is wenyao's space, how do you come in???">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="这里是文耀的space">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="../../2021/04/21/%E9%9B%B6%E7%A2%8E%E7%9A%84%E6%8A%80%E6%9C%AF/" class="post-title-link" itemprop="url">零碎的技术</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-21 14:37:04" itemprop="dateCreated datePublished" datetime="2021-04-21T14:37:04+08:00">2021-04-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-08 15:02:54" itemprop="dateModified" datetime="2021-05-08T15:02:54+08:00">2021-05-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="../../categories/uncategorized/" itemprop="url" rel="index"><span itemprop="name">uncategorized</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="零碎的技术"><a href="#零碎的技术" class="headerlink" title="零碎的技术"></a>零碎的技术</h1><h4 id="域名解析"><a href="#域名解析" class="headerlink" title="域名解析"></a>域名解析</h4><blockquote>
<p>记录类型:<br>A记录：将域名指向一个IPv4地址（例如：10.10.10.10），需要增加A记录<br>CNAME记录：如果将域名指向一个域名，实现与被指向域名相同的访问效果，需要增加CNAME记录<br>主机记录：<br>www ：将域名解析为<a target="_blank" rel="noopener" href="http://www.example.com,填写www;/">www.example.com，填写www；</a><br>@ ：将域名解析为example.com（不带www），填写@或者不填写；</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://myblog.cuimouren.cn/2021/04/21/proxy-trojan/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="../../images/avatar.gif">
      <meta itemprop="name" content="崔文耀">
      <meta itemprop="description" content="Hello, here is wenyao's space, how do you come in???">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="这里是文耀的space">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="../../2021/04/21/proxy-trojan/" class="post-title-link" itemprop="url">proxy trojan</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-21 14:02:49" itemprop="dateCreated datePublished" datetime="2021-04-21T14:02:49+08:00">2021-04-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-01-07 11:07:28" itemprop="dateModified" datetime="2022-01-07T11:07:28+08:00">2022-01-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="../../categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="proxy-trojan"><a href="#proxy-trojan" class="headerlink" title="proxy trojan"></a>proxy trojan</h1><p><a target="_blank" rel="noopener" href="https://github.com/cuiwenyao/auto-install-script">自动脚本onGitHub</a></p>
<h2 id="trojan-server-服务端"><a href="#trojan-server-服务端" class="headerlink" title="trojan server 服务端"></a>trojan server 服务端</h2><ul>
<li>傻瓜式一键部署，（等我Linux学有所成了再自己一步一步地配置）<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -O https:<span class="regexp">//</span>raw.githubusercontent.com<span class="regexp">/atrandys/</span>trojan<span class="regexp">/master/</span>trojan_mult.sh &amp;&amp; chmod +x trojan_mult.sh &amp;&amp; ./trojan_mult.sh</span><br></pre></td></tr></table></figure></li>
<li>按照提示进行部署。需要手动输入域名和密码。</li>
<li>结果会输出一个如下的配置，config。保存这个配置(config.json)，待会要用。<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;run_type&quot;</span>: <span class="string">&quot;client&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;local_addr&quot;</span>: <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;local_port&quot;</span>: <span class="number">1080</span>,</span><br><span class="line">    <span class="attr">&quot;remote_addr&quot;</span>: <span class="string">&quot;domain&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;remote_port&quot;</span>: <span class="number">443</span>,</span><br><span class="line">    <span class="attr">&quot;password&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;password&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;log_level&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;ssl&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;verify&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">&quot;verify_hostname&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">&quot;cert&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;cipher_tls13&quot;</span>:<span class="string">&quot;TLS_AES_128_GCM_SHA256:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_256_GCM_SHA384&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;sni&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;alpn&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;h2&quot;</span>,</span><br><span class="line">            <span class="string">&quot;http/1.1&quot;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">&quot;reuse_session&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">&quot;session_ticket&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">&quot;curves&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;tcp&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;no_delay&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">&quot;keep_alive&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">&quot;fast_open&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">&quot;fast_open_qlen&quot;</span>: <span class="number">20</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="trojan-client-客户端"><a href="#trojan-client-客户端" class="headerlink" title="trojan client 客户端"></a>trojan client 客户端</h2></li>
</ul>
<h3 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h3><ul>
<li>windows 下推荐使用clash。</li>
<li>github 上下载 clash for windows,安装。</li>
<li>clash 配置示例如下。<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">port:</span> <span class="number">7890</span></span><br><span class="line"><span class="attr">socks-port:</span> <span class="number">7891</span></span><br><span class="line"><span class="attr">redir-port:</span> <span class="number">7892</span></span><br><span class="line"><span class="attr">allow-lan:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">mode:</span> <span class="string">rule</span></span><br><span class="line"><span class="attr">log-level:</span> <span class="string">info</span></span><br><span class="line"><span class="attr">external-controller:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:9090</span></span><br><span class="line"><span class="attr">proxies:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">trojan</span></span><br><span class="line">    <span class="attr">name:</span> <span class="number">0.</span><span class="string">trojan</span></span><br><span class="line">    <span class="attr">server:</span> <span class="string">server&#x27;ip</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">443</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">密码</span></span><br><span class="line">    <span class="attr">sni:</span> <span class="string">download.windowsupdate.com</span></span><br><span class="line">    <span class="attr">skip-cert-verify:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">url:</span> <span class="string">http://www.gstatic.com/generate_204</span></span><br><span class="line">    <span class="attr">interval:</span> <span class="number">300</span></span><br></pre></td></tr></table></figure>
<h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3></li>
<li>以Ubuntu为例</li>
<li>下载Trojan<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd <span class="regexp">/usr/</span>src</span><br><span class="line">wget https:<span class="regexp">//gi</span>thub.com<span class="regexp">/trojan-gfw/</span>trojan<span class="regexp">/releases/</span>download<span class="regexp">/v1.16.0/</span>trojan-<span class="number">1.16</span>.<span class="number">0</span>-linux-amd64.tar.xz</span><br><span class="line">tar xvf trojan-<span class="number">1.16</span>.<span class="number">0</span>-linux-amd64.tar.xz</span><br><span class="line">cd <span class="regexp">/usr/</span>src/trojan</span><br><span class="line">vi config.json</span><br></pre></td></tr></table></figure></li>
<li>将上面server生成的config复制到这里。即可。</li>
<li>为Trojan注册服务。<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; <span class="regexp">/etc/</span>systemd<span class="regexp">/system/</span>trojan.service &lt;&lt;-EOF</span><br><span class="line">[Unit]</span><br><span class="line">Description=trojan</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">PIDFile=<span class="regexp">/usr/</span>src<span class="regexp">/trojan/</span>trojan.pid</span><br><span class="line">ExecStart=<span class="regexp">/usr/</span>src<span class="regexp">/trojan/</span>trojan -c <span class="regexp">/usr/</span>src<span class="regexp">/trojan/</span>config.json -l <span class="regexp">/usr/</span>src<span class="regexp">/trojan/</span>trojan.log</span><br><span class="line">ExecReload=<span class="regexp">/bin/</span>kill -HUP \<span class="variable">$MAINPID</span></span><br><span class="line">Restart=on-failure</span><br><span class="line">RestartSec=<span class="number">1</span>s</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure></li>
<li>启动Trojan<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="literal">start</span> trojan</span><br></pre></td></tr></table></figure></li>
<li>检查是否启动成功<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ps</span> aux | <span class="keyword">grep</span> trojan | <span class="keyword">grep</span> -v <span class="keyword">grep</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>看到有类似 /usr/src/trojan/trojan 的内容展示，即表示trojan正在运行<br>如果未启动成功，通过这个命令查看日志： cat /usr/src/trojan/trojan.log<br>还可以执行 curl ip.sb –socks5 127.0.0.1:1080, 查看结果是否为Trojan代理的IP</p>
</blockquote>
</li>
<li>设置开机启动<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="builtin-name">enable</span> trojan</span><br></pre></td></tr></table></figure></li>
<li>命令行使用Trojan代理，免去使用镜像却又找不到之苦。<blockquote>
<p>安装配置proxychains，全局翻墙通过proxychains实现，即将任何程序和Trojan的proxy建立链接，原理和浏览器的代理相似。</p>
</blockquote>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-<span class="built_in">get</span> install proxychains</span><br><span class="line"><span class="keyword">vi</span> /etc/proxychains.<span class="keyword">conf</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>在最后的ProxyList里注释默认的socks代理： socks4 前增加#表示注释<br>在最后的ProxyList里加入Trojan的代理设置： socks5 127.0.0.1 1080<br>测试本地IP: curl -4 ip.sb，将显示自己的IP<br>测试代理IP: proxychains curl -4 ip.sb，将显示Trojan代理的IP<br>后续使用的命令行需要代理时，只需要在前面加上 proxychains 即可<br>如 </p>
</blockquote>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains wget https:<span class="regexp">//gi</span>thub.com<span class="regexp">/cdr/</span>code-server<span class="regexp">/releases/</span>download<span class="regexp">/v3.9.3/</span>code-server-<span class="number">3.9</span>.<span class="number">3</span>-linux-amd64.tar.gz</span><br></pre></td></tr></table></figure>
<blockquote>
<p>hahahaha,，没错，我要开始配置code-server了。见下一讲 code-server.</p>
</blockquote>
</li>
</ul>
<h4 id="linux-加速"><a href="#linux-加速" class="headerlink" title="linux 加速"></a>linux 加速</h4><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget <span class="string">&quot;https://github.com/chiakge/Linux-NetSpeed/raw/master/tcp.sh&quot;</span> <span class="variable">&amp;&amp;</span> chmod +<span class="meta">x</span> tcp.sh <span class="variable">&amp;&amp;</span> ./tcp.sh</span><br></pre></td></tr></table></figure>

<h2 id="手动配置-trojan"><a href="#手动配置-trojan" class="headerlink" title="手动配置 trojan"></a>手动配置 trojan</h2><p>Ubuntu 20.04</p>
<p><a target="_blank" rel="noopener" href="https://github.com/trojan-gfw/trojan/wiki/Binary-&-Package-Distributions">Trojan官方</a></p>
<h3 id="简略版"><a href="#简略版" class="headerlink" title="简略版"></a>简略版</h3><p>简略版不提供伪装，安装方式也较为简单。不适合学习。</p>
<h4 id="第一步-安装Trojan"><a href="#第一步-安装Trojan" class="headerlink" title="第一步 安装Trojan"></a>第一步 安装Trojan</h4><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt -y <span class="keyword">install</span> trojan</span><br></pre></td></tr></table></figure>

<p>trojan的配置目录在 /etc/trojan/config.json</p>
<h4 id="第二步-获取证书"><a href="#第二步-获取证书" class="headerlink" title="第二步 获取证书"></a>第二步 获取证书</h4><p>将一个域名解析到VPS上并获取证书</p>
<p><a target="_blank" rel="noopener" href="https://console.cloud.tencent.com/certoverview">腾讯云获取证书</a></p>
<h4 id="第三步-安装证书"><a href="#第三步-安装证书" class="headerlink" title="第三步 安装证书"></a>第三步 安装证书</h4><p>将得到的证书上传云服务器，在下载文件中的nginx文件夹中</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scp trojan.cuimouren.cn.crt root@trojan.cuimouren.cn:/etc/trojan/trojancert</span><br><span class="line">scp trojan.cuimouren.cn.key root@trojan.cuimouren.cn:/etc/trojan/trojancert</span><br></pre></td></tr></table></figure>

<h4 id="第四步-修改trojan的配置文件"><a href="#第四步-修改trojan的配置文件" class="headerlink" title="第四步 修改trojan的配置文件"></a>第四步 修改trojan的配置文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/trojan/</span><br><span class="line">rm -rf config.json</span><br><span class="line"><span class="comment"># 写入配置文件</span></span><br><span class="line">    cat &gt; config.json &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    &quot;run_type&quot;: &quot;server&quot;,</span></span><br><span class="line"><span class="string">    &quot;local_addr&quot;: &quot;0.0.0.0&quot;,</span></span><br><span class="line"><span class="string">    &quot;local_port&quot;: 443,</span></span><br><span class="line"><span class="string">    &quot;remote_addr&quot;: &quot;127.0.0.1&quot;,</span></span><br><span class="line"><span class="string">    &quot;remote_port&quot;: 80,</span></span><br><span class="line"><span class="string">    &quot;password&quot;: [</span></span><br><span class="line"><span class="string">        &quot;passwd&quot;</span></span><br><span class="line"><span class="string">    ],</span></span><br><span class="line"><span class="string">    &quot;log_level&quot;: 1,</span></span><br><span class="line"><span class="string">    &quot;ssl&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;cert&quot;: &quot;/etc/trojan/trojancert/domain.crt&quot;,</span></span><br><span class="line"><span class="string">        &quot;key&quot;: &quot;/etc/trojan/trojancert/domain.key&quot;,</span></span><br><span class="line"><span class="string">        &quot;key_password&quot;: &quot;&quot;,</span></span><br><span class="line"><span class="string">        &quot;cipher_tls13&quot;:&quot;TLS_AES_128_GCM_SHA256:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_256_GCM_SHA384&quot;,</span></span><br><span class="line"><span class="string">        &quot;prefer_server_cipher&quot;: true,</span></span><br><span class="line"><span class="string">        &quot;alpn&quot;: [</span></span><br><span class="line"><span class="string">            &quot;http/1.1&quot;</span></span><br><span class="line"><span class="string">        ],</span></span><br><span class="line"><span class="string">        &quot;reuse_session&quot;: true,</span></span><br><span class="line"><span class="string">        &quot;session_ticket&quot;: false,</span></span><br><span class="line"><span class="string">        &quot;session_timeout&quot;: 600,</span></span><br><span class="line"><span class="string">        &quot;plain_http_response&quot;: &quot;&quot;,</span></span><br><span class="line"><span class="string">        &quot;curves&quot;: &quot;&quot;,</span></span><br><span class="line"><span class="string">        &quot;dhparam&quot;: &quot;&quot;</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    &quot;tcp&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;no_delay&quot;: true,</span></span><br><span class="line"><span class="string">        &quot;keep_alive&quot;: true,</span></span><br><span class="line"><span class="string">        &quot;fast_open&quot;: false,</span></span><br><span class="line"><span class="string">        &quot;fast_open_qlen&quot;: 20</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    &quot;mysql&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;enabled&quot;: false,</span></span><br><span class="line"><span class="string">        &quot;server_addr&quot;: &quot;127.0.0.1&quot;,</span></span><br><span class="line"><span class="string">        &quot;server_port&quot;: 3306,</span></span><br><span class="line"><span class="string">        &quot;database&quot;: &quot;trojan&quot;,</span></span><br><span class="line"><span class="string">        &quot;username&quot;: &quot;trojan&quot;,</span></span><br><span class="line"><span class="string">        &quot;password&quot;: &quot;&quot;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">systemctl <span class="built_in">enable</span> trojan</span><br><span class="line"></span><br><span class="line">systemctl restart trojan</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="第五步-clash-使用Trojan"><a href="#第五步-clash-使用Trojan" class="headerlink" title="第五步 clash 使用Trojan"></a>第五步 clash 使用Trojan</h4><p>clash 完整配置文件，附带自动自动选择代理功能。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br></pre></td><td class="code"><pre><span class="line">port: 7890</span><br><span class="line">socks-port: 7891</span><br><span class="line">redir-port: 7892</span><br><span class="line">allow-lan: false</span><br><span class="line">mode: rule</span><br><span class="line">log-level: info</span><br><span class="line">external-controller: &#x27;127.0.0.1:9090&#x27;</span><br><span class="line">proxies:</span><br><span class="line">    - &#123;type: trojan, name: &#x27;American.trojan&#x27;, server: &#x27;208.167.245.186&#x27;, port: 443, password: &#x27;Yaoyao1234&#x27;, sni: download.windowsupdate.com, skip-cert-verify: true&#125;</span><br><span class="line">proxy-groups:</span><br><span class="line">    - &#123;name: Proxy, type: select, proxies: [自动选择, &#x27;American.trojan&#x27;]&#125;</span><br><span class="line">    - &#123;name: 自动选择, type: url-test, proxies: [&#x27;American.trojan&#x27;], url: &#x27;http://www.gstatic.com/generate_204&#x27;, interval: 300&#125; </span><br><span class="line">rules:</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,mzstatic.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,akadns.net,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,aaplimg.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,cdn-apple.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,apple.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,icloud.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,icloud-content.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,zcool.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,cn,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,-cn,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,baotian.me,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,jovi.cc,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,126.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,126.net,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,127.net,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,163.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,360buyimg.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,36kr.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,acfun.tv,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,air-matters.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,aixifan.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,akamaized.net,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,alicdn,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,alipay,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,taobao,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,amap.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,autonavi.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,baidu,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,bdimg.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,bdstatic.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,bilibili.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,caiyunapp.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,clouddn.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,cnbeta.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,cnbetacdn.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,cootekservice.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,csdn.net,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ctrip.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,dgtle.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,dianping.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,douban.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,doubanio.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,duokan.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,easou.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ele.me,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,feng.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,fir.im,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,frdic.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,g-cores.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,godic.net,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,gtimg.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN,cdn.hockeyapp.net,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,hongxiu.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,hxcdn.net,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,iciba.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ifeng.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ifengimg.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ipip.net,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,iqiyi.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,jd.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,jianshu.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,knewone.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,le.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,lecloud.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,lemicp.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,luoo.net,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,meituan.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,meituan.net,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,mi.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,miaopai.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,microsoft.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,microsoftonline.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,miui.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,miwifi.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,mob.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,netease.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,officecdn,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,oschina.net,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ppsimg.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,pstatp.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,qcloud.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,qdaily.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,qdmm.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,qhimg.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,qidian.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,qihucdn.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,qiniu.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,qiniucdn.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,qiyipic.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,qq.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,qqurl.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,rarbg.to,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,rr.tv,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ruguoapp.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,segmentfault.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,sinaapp.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,sogou.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,sogoucdn.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,sohu.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,soku.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,speedtest.net,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,sspai.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,suning.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,taobao.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,tenpay.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,tmall.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,tudou.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,umetrip.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,upaiyun.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,upyun.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,v2ex.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,veryzhun.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,weather.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,weibo.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,xiami.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,xiami.net,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,xiaomicp.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ximalaya.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,xmcdn.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,xunlei.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,yhd.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,yihaodianimg.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,yinxiang.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ykimg.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,youdao.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,youku.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,zealer.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,zhihu.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,zhimg.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,umeng.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,local,DIRECT&#x27;</span><br><span class="line">    - &#x27;IP-CIDR,127.0.0.0/8,DIRECT&#x27;</span><br><span class="line">    - &#x27;IP-CIDR,172.16.0.0/12,DIRECT&#x27;</span><br><span class="line">    - &#x27;IP-CIDR,192.168.0.0/16,DIRECT&#x27;</span><br><span class="line">    - &#x27;IP-CIDR,192.168.3.0/16,DIRECT&#x27;</span><br><span class="line">    - &#x27;IP-CIDR,10.0.0.0/8,DIRECT&#x27;</span><br><span class="line">    - &#x27;IP-CIDR,17.0.0.0/8,DIRECT&#x27;</span><br><span class="line">    - &#x27;IP-CIDR,100.64.0.0/10,DIRECT&#x27;</span><br><span class="line">    - &#x27;GEOIP,CN,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN,gs.apple.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN,itunes.apple.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN,beta.itunes.apple.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN,ai.google,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,amazonaws.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,awsstatic.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,awstrack.me,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,amazon.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ant.design,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,applypixels.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,apple.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,azureedge.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,adobedtm.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,adobeccstatic.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,adobelogion.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,adobe.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,bechance.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,bechance.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,bestfolios.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,clippings.io,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,colourlovers.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,dribbble.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,dropbox.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,designernews.co,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,deviantart.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,deviantart.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,envato-static.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,envato.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,fontawesome.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,fancy.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,googleapis.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,github.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,github.io,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,goabstract.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,google.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,gmail.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,godaddy.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,hdwallpapers.in,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,iconfinder.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,imgur.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,instagram.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,imgix.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,kickstarter.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,live.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,lizhi.io,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,microsoft.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,medium.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,muz.li,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,mockupeditor.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,microsoft.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,nngroup.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,omnigroup.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,producthunt.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,pinterest.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,photolemur.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,reddit.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,segment.io,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,sfx.ms,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,setapp.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,sketchapp.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,sketch.cloud,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,stackoverflow.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,sketchpacks.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,smallpdf.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,techsmith.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,typora.io,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,themeforest.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,uistencils.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ui8.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,unsplash.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,zeplin.io,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,pusher.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,mixpanel.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,gravatar.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,hockeyapp.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,cloudfront.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,gstatic.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,googleapis.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,goo.gl,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,material.io,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,googletagmanager.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,google-analytics.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,doubleclick.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,paddleapi.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,devmate.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,amazon,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,google,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,gmail,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,youtube,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,facebook,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,fb.me,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,fbcdn.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,twitter,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,instagram,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,dropbox,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,twimg.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,blogspot,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,youtu.be,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,whatsapp,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,admarvel,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,admaster,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,adsage,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,adsmogo,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,adsrvmedia,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,adwords,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,adservice,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,domob,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,duomeng,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,dwtrack,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,guanggao,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,lianmeng,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,omgmta,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,openx,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,partnerad,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,pingfore,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,supersonicads,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,tracking,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,uedas,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,umeng,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,usage,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,wlmonitor,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,zjtoolbar,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,club,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,9to5mac.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,abpchina.org,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,adblockplus.org,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,adobe.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,alfredapp.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,amplitude.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ampproject.org,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,android.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,angularjs.org,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,aolcdn.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,apkpure.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,appledaily.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,appshopper.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,appspot.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,arcgis.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,archive.org,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,armorgames.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,aspnetcdn.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,att.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,awsstatic.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,azureedge.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,azurewebsites.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,bing.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,bintray.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,bit.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,bit.ly,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,bitbucket.org,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,bjango.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,bkrtx.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,blog.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,blogcdn.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,blogger.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,blogsmithmedia.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,blogspot.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,blogspot.hk,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,bloomberg.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,box.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,box.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,cachefly.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,chromium.org,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,cl.ly,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,cloudflare.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,cloudfront.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,cloudmagic.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,cmail19.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,cnet.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,cocoapods.org,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,comodoca.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,content.office.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,crashlytics.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,culturedcode.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,d.pr,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,danilo.to,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,dayone.me,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,db.tt,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,deskconnect.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,digicert.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,disq.us,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,disqus.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,disquscdn.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,dnsimple.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,docker.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,droplr.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,duckduckgo.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,dueapp.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,dytt8.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,edgecastcdn.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,edgekey.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,edgesuite.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,engadget.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,entrust.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,eurekavpt.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,evernote.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,fabric.io,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,fast.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,fastly.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,fc2.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,feedburner.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,feedly.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,feedsportal.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,fiftythree.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,firebaseio.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,flexibits.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,flickr.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,flipboard.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,g.co,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,gabia.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,geni.us,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,gfx.ms,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ggpht.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ghostnoteapp.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,git.io,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,github,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,globalsign.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,gmodules.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,godaddy.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,golang.org,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,gongm.in,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,goo.gl,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,goodreaders.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,goodreads.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,gravatar.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,gstatic.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,gvt0.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,hockeyapp.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,hotmail.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,icons8.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ift.tt,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ifttt.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,iherb.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,imageshack.us,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,img.ly,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,imgur.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,imore.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,instapaper.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ipn.li,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,is.gd,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,issuu.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,itgonglun.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,itun.es,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ixquick.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,j.mp,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,js.revsci.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,jshint.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,jtvnw.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,justgetflux.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,kat.cr,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,klip.me,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,libsyn.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,licdn.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,linkedin.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,linode.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,lithium.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,littlehj.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,live.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,live.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,livefilestore.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,llnwd.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,macid.co,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,macromedia.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,macrumors.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,mashable.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,mathjax.org,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,medium.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,mega.co.nz,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,mega.nz,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,megaupload.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,microsofttranslator.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,mindnode.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,mobile01.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,modmyi.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,msedge.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,myfontastic.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,name.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,nextmedia.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,nsstatic.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,nssurge.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,nyt.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,nytimes.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,office365.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,omnigroup.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,onedrive.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,onedrive.live.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,onenote.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ooyala.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,openvpn.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,openwrt.org,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,orkut.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,osxdaily.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,outlook.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ow.ly,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,paddleapi.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,parallels.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,parse.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,pdfexpert.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,periscope.tv,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,pinboard.in,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,pinterest.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,pixelmator.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,pixiv.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,playpcesor.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,playstation.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,playstation.com.hk,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,playstation.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,playstationnetwork.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,pushwoosh.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,rime.im,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,servebom.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,sfx.ms,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,shadowsocks.org,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,sharethis.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,shazam.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,skype.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,smartdnsProxy.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,smartmailcloud.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,sndcdn.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,sony.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,soundcloud.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,sourceforge.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,spotify.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,squarespace.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,sstatic.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,st.luluku.pw,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,stackoverflow.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,startpage.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,staticflickr.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,steamcommunity.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,symauth.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,symcb.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,symcd.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,tapbots.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,tapbots.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,tdesktop.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,techcrunch.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,techsmith.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,thepiratebay.org,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,theverge.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,time.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,timeinc.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,tiny.cc,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,tinypic.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,tmblr.co,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,todoist.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,trello.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,trustasiassl.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,tumblr.co,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,tumblr.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,tweetdeck.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,tweetmarker.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,twitch.tv,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,txmblr.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,typekit.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ubertags.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ublock.org,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ubnt.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ulyssesapp.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,urchin.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,usertrust.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,v.gd,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,vimeo.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,vimeocdn.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,vine.co,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,vivaldi.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,vox-cdn.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,vsco.co,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,vultr.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,w.org,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,w3schools.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,webtype.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,wikiwand.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,wikileaks.org,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,wikimedia.org,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,wikipedia.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,wikipedia.org,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,windows.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,windows.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,wire.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,wordpress.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,workflowy.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,wp.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,wsj.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,wsj.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,xda-developers.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,xeeno.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,xiti.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,yahoo.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,yimg.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ying.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,yoyo.org,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ytimg.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,telegra.ph,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,telegram.org,Proxy&#x27;</span><br><span class="line">    - &#x27;IP-CIDR,91.108.56.0/22,Proxy&#x27;</span><br><span class="line">    - &#x27;IP-CIDR,91.108.4.0/22,Proxy&#x27;</span><br><span class="line">    - &#x27;IP-CIDR,91.108.8.0/22,Proxy&#x27;</span><br><span class="line">    - &#x27;IP-CIDR,109.239.140.0/24,Proxy&#x27;</span><br><span class="line">    - &#x27;IP-CIDR,149.154.160.0/20,Proxy&#x27;</span><br><span class="line">    - &#x27;IP-CIDR,149.154.164.0/22,Proxy&#x27;</span><br><span class="line">    - &#x27;MATCH,Proxy&#x27;</span><br></pre></td></tr></table></figure>




<h3 id="非简略版"><a href="#非简略版" class="headerlink" title="非简略版"></a>非简略版</h3><p>我写了一个脚本放在了<a target="_blank" rel="noopener" href="https://github.com/cuiwenyao/trojan-auto-install">GitHub</a>上.</p>
<p>这个版本主要实现了输入自己的域名和密码。</p>
<p>现在试着进行自动获取证书。</p>
<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/cuiwenyao/trojan-auto-install/master/trojan-install.sh &amp;&amp; chmod +x trojan-install.sh &amp;&amp; ./trojan-install.sh</span><br></pre></td></tr></table></figure>

<h4 id="自动获取证书"><a href="#自动获取证书" class="headerlink" title="自动获取证书"></a>自动获取证书</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装 socat for acme</span></span><br><span class="line">apt -y install socat</span><br><span class="line"><span class="comment">#acme</span></span><br><span class="line">curl https://get.acme.sh | sh</span><br><span class="line">systemctl stop trojan</span><br><span class="line">systemctl stop nginx</span><br><span class="line">green <span class="string">&quot;注册acme for <span class="variable">$&#123;trojan_email&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">~/.acme.sh/acme.sh --register-account -m <span class="variable">$&#123;trojan_email&#125;</span></span><br><span class="line">systemctl stop nginx</span><br><span class="line">systemctl stop trojan</span><br><span class="line">rm -rf ~/.acme/<span class="variable">$&#123;trojan_domain&#125;</span></span><br><span class="line">~/.acme.sh/acme.sh  --issue --standalone -d <span class="variable">$&#123;trojan_domain&#125;</span></span><br><span class="line"></span><br><span class="line">green <span class="string">&quot;安装证书 for <span class="variable">$&#123;trojan_domain&#125;</span>&quot;</span></span><br><span class="line">rm -rf /etc/trojan/trojancert/<span class="variable">$&#123;trojan_domain&#125;</span>/</span><br><span class="line">mkdir -p /etc/trojan/trojancert/<span class="variable">$&#123;trojan_domain&#125;</span>/</span><br><span class="line">~/.acme.sh/acme.sh  --installcert  -d  <span class="variable">$&#123;trojan_domain&#125;</span>   \</span><br><span class="line">    --key-file   /etc/trojan/trojancert/<span class="variable">$&#123;trojan_domain&#125;</span>/private.key \</span><br><span class="line">    --fullchain-file  /etc/trojan/trojancert/<span class="variable">$&#123;trojan_domain&#125;</span>/fullchain.cer \</span><br><span class="line">    --reloadcmd  <span class="string">&quot;systemctl restart trojan&quot;</span>	</span><br></pre></td></tr></table></figure>

<h4 id="配置证书"><a href="#配置证书" class="headerlink" title="配置证书"></a>配置证书</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#写入nginx配置</span></span><br><span class="line">green <span class="string">&quot;正在写入nginx配置文件 /etc/nginx/nginx.conf&quot;</span></span><br><span class="line">rm /etc/nginx/nginx.conf</span><br><span class="line">        cat &gt; /etc/nginx/nginx.conf &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">user  root;</span></span><br><span class="line"><span class="string">worker_processes  1;</span></span><br><span class="line"><span class="string">error_log  /var/log/nginx/error.log warn;</span></span><br><span class="line"><span class="string">pid        /var/run/nginx.pid;</span></span><br><span class="line"><span class="string">events &#123;</span></span><br><span class="line"><span class="string">    worker_connections  1024;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">http &#123;</span></span><br><span class="line"><span class="string">    include       /etc/nginx/mime.types;</span></span><br><span class="line"><span class="string">    default_type  application/octet-stream;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    access_log  /var/log/nginx/access.log;</span></span><br><span class="line"><span class="string">    sendfile        on;</span></span><br><span class="line"><span class="string">    keepalive_timeout  120;</span></span><br><span class="line"><span class="string">    client_max_body_size 20m;</span></span><br><span class="line"><span class="string">    server &#123;</span></span><br><span class="line"><span class="string">        listen       80;</span></span><br><span class="line"><span class="string">        server_name  $&#123;trojan_domain&#125;;</span></span><br><span class="line"><span class="string">        root /etc/nginx/html;</span></span><br><span class="line"><span class="string">        index index.php index.html index.htm;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入配置文件</span></span><br><span class="line">rm /etc/trojan/config.json</span><br><span class="line">    cat &gt; /etc/trojan/config.json &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    &quot;run_type&quot;: &quot;server&quot;,</span></span><br><span class="line"><span class="string">    &quot;local_addr&quot;: &quot;0.0.0.0&quot;,</span></span><br><span class="line"><span class="string">    &quot;local_port&quot;: 443,</span></span><br><span class="line"><span class="string">    &quot;remote_addr&quot;: &quot;127.0.0.1&quot;,</span></span><br><span class="line"><span class="string">    &quot;remote_port&quot;: 80,</span></span><br><span class="line"><span class="string">    &quot;password&quot;: [</span></span><br><span class="line"><span class="string">        &quot;$trojan_passwd&quot;</span></span><br><span class="line"><span class="string">    ],</span></span><br><span class="line"><span class="string">    &quot;log_level&quot;: 1,</span></span><br><span class="line"><span class="string">    &quot;ssl&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;cert&quot;: &quot;/etc/trojan/trojancert/$&#123;trojan_domain&#125;/fullchain.cer&quot;,</span></span><br><span class="line"><span class="string">        &quot;key&quot;: &quot;/etc/trojan/trojancert/$&#123;trojan_domain&#125;/private.key&quot;,</span></span><br><span class="line"><span class="string">        &quot;key_password&quot;: &quot;&quot;,</span></span><br><span class="line"><span class="string">        &quot;cipher&quot;: &quot;ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384&quot;,</span></span><br><span class="line"><span class="string">        &quot;cipher_tls13&quot;: &quot;TLS_AES_128_GCM_SHA256:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_256_GCM_SHA384&quot;,</span></span><br><span class="line"><span class="string">        &quot;prefer_server_cipher&quot;: true,</span></span><br><span class="line"><span class="string">        &quot;alpn&quot;: [</span></span><br><span class="line"><span class="string">            &quot;http/1.1&quot;</span></span><br><span class="line"><span class="string">        ],</span></span><br><span class="line"><span class="string">        &quot;alpn_port_override&quot;: &#123;</span></span><br><span class="line"><span class="string">            &quot;h2&quot;: 81</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        &quot;reuse_session&quot;: true,</span></span><br><span class="line"><span class="string">        &quot;session_ticket&quot;: false,</span></span><br><span class="line"><span class="string">        &quot;session_timeout&quot;: 600,</span></span><br><span class="line"><span class="string">        &quot;plain_http_response&quot;: &quot;&quot;,</span></span><br><span class="line"><span class="string">        &quot;curves&quot;: &quot;&quot;,</span></span><br><span class="line"><span class="string">        &quot;dhparam&quot;: &quot;&quot;</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    &quot;tcp&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;prefer_ipv4&quot;: false,</span></span><br><span class="line"><span class="string">        &quot;no_delay&quot;: true,</span></span><br><span class="line"><span class="string">        &quot;keep_alive&quot;: true,</span></span><br><span class="line"><span class="string">        &quot;reuse_port&quot;: false,</span></span><br><span class="line"><span class="string">        &quot;fast_open&quot;: false,</span></span><br><span class="line"><span class="string">        &quot;fast_open_qlen&quot;: 20</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    &quot;mysql&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;enabled&quot;: false,</span></span><br><span class="line"><span class="string">        &quot;server_addr&quot;: &quot;127.0.0.1&quot;,</span></span><br><span class="line"><span class="string">        &quot;server_port&quot;: 3306,</span></span><br><span class="line"><span class="string">        &quot;database&quot;: &quot;trojan&quot;,</span></span><br><span class="line"><span class="string">        &quot;username&quot;: &quot;trojan&quot;,</span></span><br><span class="line"><span class="string">        &quot;password&quot;: &quot;&quot;,</span></span><br><span class="line"><span class="string">        &quot;key&quot;: &quot;&quot;,</span></span><br><span class="line"><span class="string">        &quot;cert&quot;: &quot;&quot;,</span></span><br><span class="line"><span class="string">        &quot;ca&quot;: &quot;&quot;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#注意这里，user默认值为nobody导致服务没有办法正常运行，改为root</span></span><br><span class="line">rm /lib/systemd/system/trojan.service</span><br><span class="line">    cat &gt; /lib/systemd/system/trojan.service &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=trojan</span></span><br><span class="line"><span class="string">Documentation=man:trojan(1) https://trojan-gfw.github.io/trojan/config https://trojan-gfw.github.io/trojan/</span></span><br><span class="line"><span class="string">After=network.target network-online.target nss-lookup.target mysql.service mariadb.service mysqld.service</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">Type=simple</span></span><br><span class="line"><span class="string">StandardError=journal</span></span><br><span class="line"><span class="string">User=root</span></span><br><span class="line"><span class="string">AmbientCapabilities=CAP_NET_BIND_SERVICE</span></span><br><span class="line"><span class="string">ExecStart=/usr/bin/trojan /etc/trojan/config.json</span></span><br><span class="line"><span class="string">ExecReload=/bin/kill -HUP $MAINPID</span></span><br><span class="line"><span class="string">Restart=on-failure</span></span><br><span class="line"><span class="string">RestartSec=3s</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<h4 id="一键脚本"><a href="#一键脚本" class="headerlink" title="一键脚本"></a>一键脚本</h4><p>为了方便再次配置Trojan，我将整个过程写成了一个脚本，放在了<a target="_blank" rel="noopener" href="https://github.com/cuiwenyao/trojan-auto-install">GitHub上</a></p>
<p>你也可以直接使用：适用于Ubuntu20.04及以上。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/cuiwenyao/trojan-auto-install/master/trojan-install.sh &amp;&amp; chmod +x trojan-install.sh &amp;&amp; ./trojan-install.sh</span><br></pre></td></tr></table></figure>

<p>安装bbr加速模块,这个加速模块在Ubuntu20.04以上版本会将内核搞崩，建议在Ubuntu20.04下使用。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -N --no-check-certificate <span class="string">&quot;https://raw.githubusercontent.com/chiakge/Linux-NetSpeed/master/tcp.sh&quot;</span> &amp;&amp; chmod +x tcp.sh &amp;&amp; ./tcp.sh</span><br></pre></td></tr></table></figure>

<p>这次搞这个trojan着实麻烦，好在弄好了，我的Linux技术也增加了一点点。去学习数据结构了。</p>
<h2 id="使用docker运行trojan"><a href="#使用docker运行trojan" class="headerlink" title="使用docker运行trojan"></a>使用docker运行trojan</h2><h3 id="安装思路"><a href="#安装思路" class="headerlink" title="安装思路"></a>安装思路</h3><ol>
<li>在宿主机中安装docker</li>
<li>在宿主机中获取证书</li>
<li>在宿主机中获取伪装网页</li>
<li>在宿主机中配置好宿主机的nginx反向代理，$port</li>
<li>在宿主机中配置好构建镜像中nginx和trojan需要的配置文件</li>
<li>构建docker镜像(编写Dockerfile)<ol>
<li>将<strong>证书</strong>和，<strong>伪装网页</strong>和构建镜像中nginx和trojan需要的<strong>配置文件</strong>COPY到镜像中。</li>
<li>在docker镜像中安装nginx和trojan。</li>
<li>将docker镜像中的<strong>证书</strong>和，<strong>伪装网页</strong>和构建镜像中nginx和trojan需要的<strong>配置文件</strong>放在合适的地方。</li>
<li>启动nginx和trojan</li>
</ol>
</li>
<li>构建一个镜像</li>
<li>从构建完成的镜像启动一个容器，并指定端口 $port</li>
</ol>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">function blue()&#123;</span><br><span class="line">    echo -e &quot;\033[34m\033[01m$1\033[0m&quot;</span><br><span class="line">&#125;</span><br><span class="line">function green()&#123;</span><br><span class="line">    echo -e &quot;\033[32m\033[01m$1\033[0m&quot;</span><br><span class="line">&#125;</span><br><span class="line">function red()&#123;</span><br><span class="line">    echo -e &quot;\033[31m\033[01m$1\033[0m&quot;</span><br><span class="line">&#125;</span><br><span class="line">function version_lt()&#123;</span><br><span class="line">    test &quot;$(echo &quot;$@&quot; | tr &quot; &quot; &quot;\n&quot; | sort -rV | head -n 1)&quot; != &quot;$1&quot;; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">read -p &quot;确认安装(enter) :&quot; ack</span><br><span class="line"></span><br><span class="line">read -p &quot;请输入你的域名 :&quot; trojan_domain</span><br><span class="line"></span><br><span class="line">read -p &quot;请输入你想要使用的映射端口(eg:4000):&quot; port</span><br><span class="line"></span><br><span class="line">read -p &quot;请输入你要设置的trojan密码 :&quot; trojan_passwd</span><br><span class="line"></span><br><span class="line">read -p &quot;请输入你的邮箱用来注册acme(必须) :&quot; trojan_email</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">安装前准备</span></span><br><span class="line">mkdir -p ~/trojan_docker</span><br><span class="line">cd trojan_docker</span><br><span class="line">apt-get -y update</span><br><span class="line">apt-get -y install wget curl cron nginx git socat</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">1. 在宿主机中安装docker</span></span><br><span class="line">green &quot;1. 在宿主机中安装docker&quot;</span><br><span class="line">apt -y remove docker docker-engine docker.io</span><br><span class="line">apt -y install apt-transport-https ca-certificates curl gnupg lsb-release</span><br><span class="line">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg</span><br><span class="line">echo &quot;deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \</span><br><span class="line"><span class="meta">  $</span><span class="bash">(lsb_release -cs) stable<span class="string">&quot; | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null</span></span></span><br><span class="line">apt update</span><br><span class="line">apt -y install docker-ce docker-ce-cli containerd.io</span><br><span class="line">green &quot;docker安装成功&quot;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">2. 在宿主机中获取证书</span></span><br><span class="line">green &quot;2. 在宿主机中获取证书&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash">acme</span></span><br><span class="line">curl https://get.acme.sh | sh</span><br><span class="line">source ~/.bashrc</span><br><span class="line">green &quot;停止web服务&quot;</span><br><span class="line">systemctl stop trojan</span><br><span class="line">systemctl stop nginx</span><br><span class="line">systemctl stop apache</span><br><span class="line">systemctl stop apache2</span><br><span class="line">green &quot;注册acme for $&#123;trojan_email&#125;&quot;</span><br><span class="line">~/.acme.sh/acme.sh --register-account -m $&#123;trojan_email&#125;</span><br><span class="line">rm -rf ~/.acme/$&#123;trojan_domain&#125;</span><br><span class="line">~/.acme.sh/acme.sh  --issue --standalone -d $&#123;trojan_domain&#125;</span><br><span class="line">green &quot;安装证书 for $&#123;trojan_domain&#125;&quot;</span><br><span class="line">rm -rf ~/trojan_docker/trojancert/$&#123;trojan_domain&#125;</span><br><span class="line">mkdir -p ~/trojan_docker/trojancert/$&#123;trojan_domain&#125;</span><br><span class="line">~/.acme.sh/acme.sh  --installcert  -d  $&#123;trojan_domain&#125;   \</span><br><span class="line">    --key-file   ~/trojan_docker/trojancert/$&#123;trojan_domain&#125;/private.key \</span><br><span class="line">    --fullchain-file  ~/trojan_docker/trojancert/$&#123;trojan_domain&#125;/fullchain.cer </span><br><span class="line"><span class="meta">#</span><span class="bash">证书放在 ~/trojan_docker/trojancert/<span class="variable">$&#123;trojan_domain&#125;</span> 中</span></span><br><span class="line">green &quot;证书放在 ~/trojan_docker/trojancert/$&#123;trojan_domain&#125;&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash">3. 在宿主机中获取伪装网页</span></span><br><span class="line">green &quot;3. 在宿主机中获取伪装网页&quot;</span><br><span class="line">cd ~/trojan_docker</span><br><span class="line">git clone https://github.com/cuiwenyao/cuiwenyao.io.git</span><br><span class="line"><span class="meta">#</span><span class="bash">4. 在宿主机中配置好宿主机的nginx反向代理，<span class="variable">$port</span></span></span><br><span class="line">green &quot;4. 在宿主机中配置好宿主机的nginx反向代理，$port&quot;</span><br><span class="line">rm /etc/nginx/sites-available/$&#123;trojan_domain&#125;</span><br><span class="line">rm /etc/nginx/sites-enabled/$&#123;trojan_domain&#125;</span><br><span class="line">cat &gt; /etc/nginx/sites-available/$&#123;trojan_domain&#125; &lt;&lt;-EOF</span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    listen [::]:80;</span><br><span class="line">    server_name $&#123;trojan_domain&#125;;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">      proxy_pass http://localhost:$&#123;port&#125;/;</span><br><span class="line">      proxy_set_header Upgrade \$http_upgrade;</span><br><span class="line">      proxy_set_header Connection upgrade;</span><br><span class="line">      proxy_set_header Accept-Encoding gzip;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">cd /etc/nginx/sites-enabled/</span><br><span class="line">ln -s /etc/nginx/sites-available/$&#123;trojan_domain&#125; /etc/nginx/sites-enabled/$&#123;trojan_domain&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash">5. 在宿主机中配置好构建镜像中nginx和trojan需要的配置文件</span></span><br><span class="line">green &quot;5. 在宿主机中配置好构建镜像中nginx和trojan需要的配置文件&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash">nginx</span></span><br><span class="line">        cat &gt; ~/trojan_docker/nginx.conf &lt;&lt;-EOF</span><br><span class="line">user  root;</span><br><span class="line">worker_processes  1;</span><br><span class="line">error_log  /var/log/nginx/error.log warn;</span><br><span class="line">pid        /var/run/nginx.pid;</span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line">http &#123;</span><br><span class="line">    include       /etc/nginx/mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    access_log  /var/log/nginx/access.log;</span><br><span class="line">    sendfile        on;</span><br><span class="line">    keepalive_timeout  120;</span><br><span class="line">    client_max_body_size 20m;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  $&#123;trojan_domain&#125;;</span><br><span class="line">        root /etc/nginx/html;</span><br><span class="line">        index index.php index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"><span class="meta">#</span><span class="bash">trojan</span></span><br><span class="line">    cat &gt; ~/trojan_docker/config.json &lt;&lt;-EOF</span><br><span class="line">&#123;</span><br><span class="line">    &quot;run_type&quot;: &quot;server&quot;,</span><br><span class="line">    &quot;local_addr&quot;: &quot;0.0.0.0&quot;,</span><br><span class="line">    &quot;local_port&quot;: 443,</span><br><span class="line">    &quot;remote_addr&quot;: &quot;127.0.0.1&quot;,</span><br><span class="line">    &quot;remote_port&quot;: 80,</span><br><span class="line">    &quot;password&quot;: [</span><br><span class="line">        &quot;$trojan_passwd&quot;</span><br><span class="line">    ],</span><br><span class="line">    &quot;log_level&quot;: 1,</span><br><span class="line">    &quot;ssl&quot;: &#123;</span><br><span class="line">        &quot;cert&quot;: &quot;/etc/trojan/trojancert/$&#123;trojan_domain&#125;/fullchain.cer&quot;,</span><br><span class="line">        &quot;key&quot;: &quot;/etc/trojan/trojancert/$&#123;trojan_domain&#125;/private.key&quot;,</span><br><span class="line">        &quot;key_password&quot;: &quot;&quot;,</span><br><span class="line">        &quot;cipher&quot;: &quot;ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384&quot;,</span><br><span class="line">        &quot;cipher_tls13&quot;: &quot;TLS_AES_128_GCM_SHA256:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_256_GCM_SHA384&quot;,</span><br><span class="line">        &quot;prefer_server_cipher&quot;: true,</span><br><span class="line">        &quot;alpn&quot;: [</span><br><span class="line">            &quot;http/1.1&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;alpn_port_override&quot;: &#123;</span><br><span class="line">            &quot;h2&quot;: 81</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;reuse_session&quot;: true,</span><br><span class="line">        &quot;session_ticket&quot;: false,</span><br><span class="line">        &quot;session_timeout&quot;: 600,</span><br><span class="line">        &quot;plain_http_response&quot;: &quot;&quot;,</span><br><span class="line">        &quot;curves&quot;: &quot;&quot;,</span><br><span class="line">        &quot;dhparam&quot;: &quot;&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;tcp&quot;: &#123;</span><br><span class="line">        &quot;prefer_ipv4&quot;: false,</span><br><span class="line">        &quot;no_delay&quot;: true,</span><br><span class="line">        &quot;keep_alive&quot;: true,</span><br><span class="line">        &quot;reuse_port&quot;: false,</span><br><span class="line">        &quot;fast_open&quot;: false,</span><br><span class="line">        &quot;fast_open_qlen&quot;: 20</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;mysql&quot;: &#123;</span><br><span class="line">        &quot;enabled&quot;: false,</span><br><span class="line">        &quot;server_addr&quot;: &quot;127.0.0.1&quot;,</span><br><span class="line">        &quot;server_port&quot;: 3306,</span><br><span class="line">        &quot;database&quot;: &quot;trojan&quot;,</span><br><span class="line">        &quot;username&quot;: &quot;trojan&quot;,</span><br><span class="line">        &quot;password&quot;: &quot;&quot;,</span><br><span class="line">        &quot;key&quot;: &quot;&quot;,</span><br><span class="line">        &quot;cert&quot;: &quot;&quot;,</span><br><span class="line">        &quot;ca&quot;: &quot;&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">cd ~</span><br><span class="line">tar -cvf trojan_docker.tar ./trojan_docker/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">4. 构建docker镜像(编写Dockerfile)</span></span><br><span class="line">green &quot;4. 构建docker镜像(编写Dockerfile)&quot;</span><br><span class="line">green &quot;1. 将**证书**和，**伪装网页**和构建镜像中nginx和trojan需要的**配置文件**COPY到镜像中。&quot;</span><br><span class="line">green &quot;2. 在docker镜像中安装nginx和trojan。&quot;</span><br><span class="line">green &quot;3. 将docker镜像中的**证书**和，**伪装网页**和构建镜像中nginx和trojan需要的**配置文件**放在合适的地方。&quot;</span><br><span class="line">green &quot;4. 启动nginx和trojan&quot;</span><br><span class="line"></span><br><span class="line">cat &gt; ~/trojan_docker/Dockerfile  &lt;&lt;-EOF</span><br><span class="line">FROM ubuntu:20.04</span><br><span class="line">COPY ./trojan_docker.tar /root/</span><br><span class="line">RUN apt -y update \</span><br><span class="line">&amp;&amp; apt -y install nginx trojan \</span><br><span class="line">&amp;&amp; cd ~         \</span><br><span class="line">&amp;&amp; tar -xvf trojan_docker.tar \</span><br><span class="line">&amp;&amp; mkdir -p /etc/trojan/trojancert/$&#123;trojan_domain&#125;/ \</span><br><span class="line">&amp;&amp; mv  ~/trojan_docker/trojancert/$&#123;trojan_domain&#125;/private.key  /etc/trojan/trojancert/$&#123;trojan_domain&#125;/private.key  \</span><br><span class="line">&amp;&amp; mv  ~/trojan_docker/trojancert/$&#123;trojan_domain&#125;/fullchain.cer   /etc/trojan/trojancert/$&#123;trojan_domain&#125;/fullchain.cer   \</span><br><span class="line">&amp;&amp; rm /etc/nginx/nginx.conf \</span><br><span class="line">&amp;&amp; mv ~/trojan_docker/nginx.conf  /etc/nginx/nginx.conf \</span><br><span class="line">&amp;&amp; rm /etc/trojan/config.json \</span><br><span class="line">&amp;&amp; mv ~/trojan_docker/config.json  /etc/trojan/config.json \</span><br><span class="line">&amp;&amp; rm -rf /etc/nginx/html \</span><br><span class="line">&amp;&amp; mv ~/trojan_docker/cuiwenyao.io  /etc/nginx/html  \</span><br><span class="line">&amp;&amp; rm -rf ~/trojan_docker/cuiwneyao.io </span><br><span class="line">CMD [&quot;sh&quot;,&quot;-c&quot;,&quot;nginx &amp;&amp; trojan&quot;]</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">5. 构建一个镜像</span></span><br><span class="line">green &quot;5. 构建一个镜像&quot;</span><br><span class="line">cd ~</span><br><span class="line">docker image rm -f trojan_image</span><br><span class="line">docker build -f ~/trojan_docker/Dockerfile -t trojan_image .</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">6. 从构建完成的镜像启动一个容器，并指定端口 <span class="variable">$port</span></span></span><br><span class="line">docker container rm -f trojan_docker</span><br><span class="line">docker run --name trojan_docker -itd -p $&#123;port&#125;:443  trojan_image</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">7. 保存镜像</span></span><br><span class="line">green &quot;保存镜像至 ~/trojan_image.tar.gz&quot;</span><br><span class="line">docker save trojan_image | gzip &gt; trojan_image.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">清理</span> </span><br><span class="line">green &quot;clean-----------------------------------------&quot;</span><br><span class="line">rm -rf trojan_docker  trojan_docker.tar</span><br><span class="line"></span><br><span class="line">green &quot;trojan_docker安装成功&quot;</span><br><span class="line">green &quot;config_client.json中为Linux下的proxy客户端配置示例&quot;</span><br><span class="line">green &quot;config_clash.yml中为clash下的proxy客户端配置示例&quot;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">Linux client</span> </span><br><span class="line">rm -rf config_client.json</span><br><span class="line">cat &gt; config_client.json &lt;&lt;-EOF</span><br><span class="line">&#123;</span><br><span class="line">    &quot;run_type&quot;: &quot;client&quot;,</span><br><span class="line">    &quot;local_addr&quot;: &quot;127.0.0.1&quot;,</span><br><span class="line">    &quot;local_port&quot;: 1080,</span><br><span class="line">    &quot;remote_addr&quot;: &quot;$trojan_domain&quot;,</span><br><span class="line">    &quot;remote_port&quot;: 443,</span><br><span class="line">    &quot;password&quot;: [</span><br><span class="line">        &quot;$trojan_passwd&quot;</span><br><span class="line">    ],</span><br><span class="line">    &quot;log_level&quot;: 1,</span><br><span class="line">    &quot;ssl&quot;: &#123;</span><br><span class="line">        &quot;verify&quot;: true,</span><br><span class="line">        &quot;verify_hostname&quot;: true,</span><br><span class="line">        &quot;cert&quot;: &quot;&quot;,</span><br><span class="line">        &quot;cipher_tls13&quot;:&quot;TLS_AES_128_GCM_SHA256:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_256_GCM_SHA384&quot;,</span><br><span class="line">        &quot;sni&quot;: &quot;&quot;,</span><br><span class="line">        &quot;alpn&quot;: [</span><br><span class="line">            &quot;h2&quot;,</span><br><span class="line">            &quot;http/1.1&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;reuse_session&quot;: true,</span><br><span class="line">        &quot;session_ticket&quot;: false,</span><br><span class="line">        &quot;curves&quot;: &quot;&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;tcp&quot;: &#123;</span><br><span class="line">        &quot;no_delay&quot;: true,</span><br><span class="line">        &quot;keep_alive&quot;: true,</span><br><span class="line">        &quot;fast_open&quot;: false,</span><br><span class="line">        &quot;fast_open_qlen&quot;: 20</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">clash</span> </span><br><span class="line">rm -rf config_clash.yml</span><br><span class="line">cat &gt; config_clash.yml &lt;&lt;-EOF</span><br><span class="line">port: 7890</span><br><span class="line">socks-port: 7891</span><br><span class="line">redir-port: 7892</span><br><span class="line">allow-lan: false</span><br><span class="line">mode: rule</span><br><span class="line">log-level: info</span><br><span class="line">external-controller: &#x27;127.0.0.1:9090&#x27;</span><br><span class="line">proxies:</span><br><span class="line">    - &#123;type: trojan, name: &#x27;trojan&#x27;, server: &#x27;$trojan_domain&#x27;, port: $&#123;port&#125;, password: &#x27;$trojan_passwd&#x27;, sni: download.windowsupdate.com, skip-cert-verify: true&#125;</span><br><span class="line">proxy-groups:</span><br><span class="line">    - &#123;name: Proxy, type: select, proxies: [自动选择, &#x27;trojan&#x27;]&#125;</span><br><span class="line">    - &#123;name: 自动选择, type: url-test, proxies: [&#x27;trojan&#x27;], url: &#x27;http://www.gstatic.com/generate_204&#x27;, interval: 300&#125; </span><br><span class="line">rules:</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,mzstatic.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,akadns.net,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,aaplimg.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,cdn-apple.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,apple.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,icloud.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,icloud-content.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,zcool.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,cn,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,-cn,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,baotian.me,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,jovi.cc,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,126.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,126.net,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,127.net,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,163.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,360buyimg.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,36kr.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,acfun.tv,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,air-matters.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,aixifan.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,akamaized.net,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,alicdn,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,alipay,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,taobao,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,amap.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,autonavi.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,baidu,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,bdimg.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,bdstatic.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,bilibili.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,caiyunapp.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,clouddn.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,cnbeta.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,cnbetacdn.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,cootekservice.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,csdn.net,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ctrip.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,dgtle.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,dianping.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,douban.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,doubanio.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,duokan.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,easou.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ele.me,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,feng.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,fir.im,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,frdic.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,g-cores.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,godic.net,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,gtimg.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN,cdn.hockeyapp.net,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,hongxiu.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,hxcdn.net,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,iciba.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ifeng.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ifengimg.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ipip.net,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,iqiyi.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,jd.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,jianshu.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,knewone.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,le.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,lecloud.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,lemicp.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,luoo.net,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,meituan.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,meituan.net,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,mi.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,miaopai.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,microsoft.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,microsoftonline.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,miui.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,miwifi.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,mob.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,netease.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,officecdn,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,oschina.net,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ppsimg.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,pstatp.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,qcloud.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,qdaily.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,qdmm.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,qhimg.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,qidian.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,qihucdn.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,qiniu.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,qiniucdn.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,qiyipic.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,qq.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,qqurl.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,rarbg.to,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,rr.tv,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ruguoapp.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,segmentfault.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,sinaapp.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,sogou.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,sogoucdn.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,sohu.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,soku.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,speedtest.net,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,sspai.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,suning.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,taobao.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,tenpay.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,tmall.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,tudou.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,umetrip.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,upaiyun.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,upyun.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,v2ex.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,veryzhun.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,weather.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,weibo.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,xiami.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,xiami.net,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,xiaomicp.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ximalaya.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,xmcdn.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,xunlei.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,yhd.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,yihaodianimg.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,yinxiang.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ykimg.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,youdao.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,youku.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,zealer.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,zhihu.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,zhimg.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,umeng.com,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,local,DIRECT&#x27;</span><br><span class="line">    - &#x27;IP-CIDR,127.0.0.0/8,DIRECT&#x27;</span><br><span class="line">    - &#x27;IP-CIDR,172.16.0.0/12,DIRECT&#x27;</span><br><span class="line">    - &#x27;IP-CIDR,192.168.0.0/16,DIRECT&#x27;</span><br><span class="line">    - &#x27;IP-CIDR,192.168.3.0/16,DIRECT&#x27;</span><br><span class="line">    - &#x27;IP-CIDR,10.0.0.0/8,DIRECT&#x27;</span><br><span class="line">    - &#x27;IP-CIDR,17.0.0.0/8,DIRECT&#x27;</span><br><span class="line">    - &#x27;IP-CIDR,100.64.0.0/10,DIRECT&#x27;</span><br><span class="line">    - &#x27;GEOIP,CN,DIRECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN,gs.apple.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN,itunes.apple.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN,beta.itunes.apple.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN,ai.google,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,amazonaws.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,awsstatic.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,awstrack.me,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,amazon.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ant.design,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,applypixels.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,apple.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,azureedge.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,adobedtm.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,adobeccstatic.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,adobelogion.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,adobe.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,bechance.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,bechance.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,bestfolios.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,clippings.io,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,colourlovers.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,dribbble.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,dropbox.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,designernews.co,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,deviantart.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,deviantart.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,envato-static.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,envato.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,fontawesome.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,fancy.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,googleapis.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,github.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,github.io,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,goabstract.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,google.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,gmail.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,godaddy.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,hdwallpapers.in,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,iconfinder.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,imgur.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,instagram.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,imgix.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,kickstarter.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,live.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,lizhi.io,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,microsoft.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,medium.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,muz.li,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,mockupeditor.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,microsoft.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,nngroup.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,omnigroup.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,producthunt.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,pinterest.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,photolemur.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,reddit.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,segment.io,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,sfx.ms,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,setapp.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,sketchapp.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,sketch.cloud,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,stackoverflow.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,sketchpacks.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,smallpdf.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,techsmith.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,typora.io,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,themeforest.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,uistencils.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ui8.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,unsplash.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,zeplin.io,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,pusher.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,mixpanel.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,gravatar.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,hockeyapp.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,cloudfront.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,gstatic.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,googleapis.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,goo.gl,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,material.io,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,googletagmanager.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,google-analytics.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,doubleclick.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,paddleapi.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,devmate.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,amazon,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,google,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,gmail,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,youtube,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,facebook,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,fb.me,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,fbcdn.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,twitter,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,instagram,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,dropbox,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,twimg.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,blogspot,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,youtu.be,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,whatsapp,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,admarvel,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,admaster,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,adsage,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,adsmogo,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,adsrvmedia,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,adwords,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,adservice,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,domob,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,duomeng,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,dwtrack,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,guanggao,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,lianmeng,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,omgmta,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,openx,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,partnerad,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,pingfore,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,supersonicads,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,tracking,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,uedas,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,umeng,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,usage,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,wlmonitor,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,zjtoolbar,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,club,REJECT&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,9to5mac.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,abpchina.org,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,adblockplus.org,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,adobe.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,alfredapp.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,amplitude.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ampproject.org,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,android.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,angularjs.org,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,aolcdn.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,apkpure.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,appledaily.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,appshopper.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,appspot.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,arcgis.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,archive.org,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,armorgames.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,aspnetcdn.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,att.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,awsstatic.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,azureedge.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,azurewebsites.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,bing.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,bintray.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,bit.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,bit.ly,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,bitbucket.org,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,bjango.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,bkrtx.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,blog.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,blogcdn.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,blogger.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,blogsmithmedia.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,blogspot.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,blogspot.hk,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,bloomberg.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,box.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,box.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,cachefly.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,chromium.org,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,cl.ly,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,cloudflare.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,cloudfront.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,cloudmagic.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,cmail19.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,cnet.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,cocoapods.org,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,comodoca.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,content.office.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,crashlytics.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,culturedcode.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,d.pr,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,danilo.to,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,dayone.me,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,db.tt,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,deskconnect.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,digicert.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,disq.us,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,disqus.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,disquscdn.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,dnsimple.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,docker.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,droplr.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,duckduckgo.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,dueapp.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,dytt8.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,edgecastcdn.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,edgekey.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,edgesuite.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,engadget.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,entrust.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,eurekavpt.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,evernote.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,fabric.io,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,fast.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,fastly.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,fc2.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,feedburner.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,feedly.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,feedsportal.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,fiftythree.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,firebaseio.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,flexibits.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,flickr.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,flipboard.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,g.co,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,gabia.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,geni.us,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,gfx.ms,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ggpht.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ghostnoteapp.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,git.io,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-KEYWORD,github,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,globalsign.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,gmodules.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,godaddy.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,golang.org,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,gongm.in,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,goo.gl,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,goodreaders.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,goodreads.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,gravatar.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,gstatic.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,gvt0.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,hockeyapp.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,hotmail.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,icons8.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ift.tt,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ifttt.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,iherb.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,imageshack.us,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,img.ly,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,imgur.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,imore.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,instapaper.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ipn.li,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,is.gd,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,issuu.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,itgonglun.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,itun.es,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ixquick.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,j.mp,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,js.revsci.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,jshint.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,jtvnw.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,justgetflux.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,kat.cr,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,klip.me,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,libsyn.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,licdn.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,linkedin.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,linode.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,lithium.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,littlehj.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,live.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,live.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,livefilestore.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,llnwd.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,macid.co,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,macromedia.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,macrumors.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,mashable.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,mathjax.org,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,medium.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,mega.co.nz,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,mega.nz,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,megaupload.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,microsofttranslator.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,mindnode.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,mobile01.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,modmyi.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,msedge.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,myfontastic.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,name.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,nextmedia.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,nsstatic.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,nssurge.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,nyt.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,nytimes.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,office365.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,omnigroup.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,onedrive.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,onedrive.live.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,onenote.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ooyala.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,openvpn.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,openwrt.org,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,orkut.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,osxdaily.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,outlook.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ow.ly,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,paddleapi.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,parallels.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,parse.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,pdfexpert.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,periscope.tv,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,pinboard.in,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,pinterest.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,pixelmator.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,pixiv.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,playpcesor.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,playstation.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,playstation.com.hk,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,playstation.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,playstationnetwork.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,pushwoosh.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,rime.im,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,servebom.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,sfx.ms,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,shadowsocks.org,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,sharethis.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,shazam.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,skype.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,smartdnsProxy.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,smartmailcloud.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,sndcdn.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,sony.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,soundcloud.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,sourceforge.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,spotify.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,squarespace.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,sstatic.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,st.luluku.pw,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,stackoverflow.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,startpage.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,staticflickr.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,steamcommunity.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,symauth.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,symcb.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,symcd.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,tapbots.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,tapbots.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,tdesktop.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,techcrunch.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,techsmith.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,thepiratebay.org,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,theverge.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,time.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,timeinc.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,tiny.cc,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,tinypic.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,tmblr.co,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,todoist.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,trello.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,trustasiassl.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,tumblr.co,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,tumblr.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,tweetdeck.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,tweetmarker.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,twitch.tv,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,txmblr.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,typekit.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ubertags.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ublock.org,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ubnt.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ulyssesapp.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,urchin.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,usertrust.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,v.gd,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,vimeo.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,vimeocdn.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,vine.co,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,vivaldi.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,vox-cdn.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,vsco.co,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,vultr.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,w.org,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,w3schools.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,webtype.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,wikiwand.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,wikileaks.org,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,wikimedia.org,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,wikipedia.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,wikipedia.org,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,windows.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,windows.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,wire.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,wordpress.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,workflowy.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,wp.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,wsj.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,wsj.net,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,xda-developers.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,xeeno.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,xiti.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,yahoo.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,yimg.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ying.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,yoyo.org,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,ytimg.com,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,telegra.ph,Proxy&#x27;</span><br><span class="line">    - &#x27;DOMAIN-SUFFIX,telegram.org,Proxy&#x27;</span><br><span class="line">    - &#x27;IP-CIDR,91.108.56.0/22,Proxy&#x27;</span><br><span class="line">    - &#x27;IP-CIDR,91.108.4.0/22,Proxy&#x27;</span><br><span class="line">    - &#x27;IP-CIDR,91.108.8.0/22,Proxy&#x27;</span><br><span class="line">    - &#x27;IP-CIDR,109.239.140.0/24,Proxy&#x27;</span><br><span class="line">    - &#x27;IP-CIDR,149.154.160.0/20,Proxy&#x27;</span><br><span class="line">    - &#x27;IP-CIDR,149.154.164.0/22,Proxy&#x27;</span><br><span class="line">    - &#x27;MATCH,Proxy&#x27;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h1 id="另一种简单的方法"><a href="#另一种简单的方法" class="headerlink" title="另一种简单的方法"></a>另一种简单的方法</h1><p>参考 <a target="_blank" rel="noopener" href="https://www.white-plus.net/simple/index.php?t1112373.html">https://www.white-plus.net/simple/index.php?t1112373.html</a></p>
<ol>
<li><a target="_blank" rel="noopener" href="https://github.com/Jrohy/trojan">https://github.com/Jrohy/trojan</a> 使用这个项目一键搭建Trojan管理平台，建立用户并自动导入clash </li>
<li>将clash设置为tun模式（方便使用命令行下载各种库）</li>
</ol>
<h2 id="clash-tun"><a href="#clash-tun" class="headerlink" title="clash tun"></a>clash tun</h2><ol>
<li>开启service mode</li>
<li>开启tun mode<br> 修改 interface-name为需要的，WLAN / 以太网 / etc</li>
<li>修改mixin :<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">tun:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">stack:</span> <span class="string">gvisor</span> <span class="comment"># or system</span></span><br><span class="line">  <span class="attr">dns-hijack:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">198.18</span><span class="number">.0</span><span class="number">.2</span><span class="string">:53</span> <span class="comment"># when `fake-ip-range` is 198.18.0.1/16, should hijack 198.18.0.2:53</span></span><br><span class="line">  <span class="attr">auto-route:</span> <span class="literal">true</span> <span class="comment"># auto set global route for Windows</span></span><br><span class="line">  <span class="comment"># It is recommended to use `interface-name`</span></span><br><span class="line">  <span class="attr">interface-name:</span> <span class="string">WLAN</span></span><br></pre></td></tr></table></figure></li>
<li>打开tun mode， mixin, 关闭 system proxy</li>
<li>正常使用可以代理所有流量</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="../4/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="../../">1</a><span class="space">&hellip;</span><a class="page-number" href="../4/">4</a><span class="page-number current">5</span><a class="page-number" href="../6/">6</a><a class="extend next" rel="next" href="../6/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">崔文耀</p>
  <div class="site-description" itemprop="description">Hello, here is wenyao's space, how do you come in???</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="../../archives/">
        
          <span class="site-state-item-count">67</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="../../categories/">
          
        <span class="site-state-item-count">47</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="../../tags/">
          
        <span class="site-state-item-count">67</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="sidebar-button motion-element"><i class="fa fa-comment"></i>
    Chat
  </a>
  </div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="../../https:/github.com/cuiwenyao" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;cuiwenyao" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="../../mailto:yao1970099540@gmail.com" title="E-Mail → mailto:yao1970099540@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2019 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">崔文耀</span>
</div>
  <div class="powered-by">由 <a href="../../https:/hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="../../https:/muse.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="../../lib/anime.min.js"></script>
  <script src="../../lib/velocity/velocity.min.js"></script>
  <script src="../../lib/velocity/velocity.ui.min.js"></script>

<script src="../../js/utils.js"></script>

<script src="../../js/motion.js"></script>


<script src="../../js/schemes/muse.js"></script>


<script src="../../js/next-boot.js"></script>

<script src="../../js/bookmark.js"></script>




  















  

  

</body>
</html>
